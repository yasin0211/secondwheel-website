<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Second Wheel — Buy Vehicles</title>
<meta name="theme-color" content="#111827" />
<style>
  :root{
    --bg:#0b0f17; --card:#121826; --ink:#e5e7eb; --muted:#9aa3b2;
    --line:rgba(255,255,255,.10); --brand:#f59e0b; --ok:#22c55e;
    --shadow:0 8px 28px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);
       font:14px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial}
  a{color:inherit;text-decoration:none}
  img{max-width:100%;display:block}
  .wrap{max-width:1160px;margin:0 auto;padding:16px}
  .muted{color:var(--muted)}

  /* Header */
  header{position:sticky;top:0;z-index:30;background:rgba(11,15,23,.78);
         backdrop-filter:blur(12px);border-bottom:1px solid var(--line)}
  .nav{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 12px}
  .brand{display:flex;gap:12px;align-items:center}
  /* logo — same sizing as index */
  .brand img{width:clamp(44px,7vw,64px);height:clamp(44px,7vw,64px);object-fit:contain;border-radius:12px;background:#fff}
  .brand h1{margin:0;font-size:18px;letter-spacing:.3px}
  .toolbar{display:flex;gap:8px;align-items:center}
  .seg{display:inline-flex;border:1px solid var(--line);border-radius:999px;overflow:hidden}
  .seg button{border:0;background:transparent;color:var(--ink);padding:8px 10px;cursor:pointer}
  .seg button.active{background:rgba(255,255,255,.16)}
  .iconbtn{border:1px solid var(--line);background:rgba(255,255,255,.06);padding:8px 10px;border-radius:10px;cursor:pointer}
  .vbtn{display:inline-flex;align-items:center;justify-content:center;padding:10px 14px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.06);font-weight:700}

  /* Tabs */
  .tabs{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:14px 0 10px}
  .tab{padding:10px 14px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.06);cursor:pointer}
  .tab.active{background:linear-gradient(180deg,#f59e0b,#b45309);color:#111;border-color:transparent}

  /* Listing grid */
  .grid{display:grid;gap:14px;grid-template-columns:1fr}
  @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
  @media(min-width:1040px){.grid{grid-template-columns:1fr 1fr 1fr}}

  /* Vehicle card */
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
  .gallery{position:relative}
  .main-img{width:100%;height:clamp(220px,28vw,280px);object-fit:cover;background:#0f1522;cursor:zoom-in}
  .thumbs{display:flex;gap:8px;overflow:auto;padding:8px;border-top:1px solid var(--line)}
  .thumbs img{height:64px;width:96px;object-fit:cover;border-radius:8px;border:2px solid transparent;cursor:pointer}
  .thumbs img.active{border-color:#f59e0b}
  .body{padding:12px}
  .title{margin:0 0 4px;font-size:16px;font-weight:800}
  .meta{display:flex;flex-wrap:wrap;gap:8px;margin:6px 0;color:#cbd5e1}
  .pill{padding:2px 8px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid var(--line);font-size:12px}
  .price{margin-left:auto;font-weight:800}
  .desc{white-space:pre-wrap;line-height:1.5;color:#e5e7eb;margin-top:8px;background:rgba(255,255,255,.03);
        border:1px solid var(--line);padding:10px;border-radius:10px}
  .actions-row{display:flex;gap:8px;margin-top:10px}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--line);
       background:rgba(255,255,255,.06);cursor:pointer}
  .btn.primary{background:linear-gradient(180deg,#22c55e,#15803d);color:#fff;border-color:transparent}
  .btn.wish.active{background:rgba(255,255,255,.12)}

  /* Lightbox / Zoom */
  .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:60}
  .lightbox.show{display:flex}
  .lb-img{max-width:92vw;max-height:86vh;object-fit:contain}
  .navbtn{position:absolute;top:50%;transform:translateY(-50%);font-size:28px;background:rgba(255,255,255,.12);
          border:1px solid var(--line);border-radius:50%;width:44px;height:44px;display:grid;place-items:center;cursor:pointer}
  .navbtn.prev{left:14px}.navbtn.next{right:14px}
  .closebtn{position:absolute;top:14px;right:14px;font-size:24px;background:rgba(255,255,255,.12);
            border:1px solid var(--line);border-radius:50%;width:40px;height:40px;display:grid;place-items:center;cursor:pointer}

  /* Toast */
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:#111827;color:#e5e7eb;border:1px solid var(--line);
         padding:10px 14px;border-radius:10px;box-shadow:var(--shadow);opacity:0;pointer-events:none;transition:opacity .3s;z-index:70}
  .toast.show{opacity:1}
</style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="nav wrap">
      <div class="brand">
        <img src="https://wbjwvxckbfkutqqbgupq.supabase.co/storage/v1/object/public/vehicals/logo.png" alt="Logo">
        <div>
          <h1>SECOND WHEEL</h1>
          <div class="muted">Trusted Vehicles, Smart Deals</div>
        </div>
      </div>
      <div class="toolbar">
        <div id="langSeg" class="seg" aria-label="Language">
          <button data-lang="en" class="active">EN</button>
          <button data-lang="hi">HI</button>
          <button data-lang="mr">MR</button>
        </div>
        <a class="vbtn" href="index.html">Home</a>
        <button id="darkToggle" class="iconbtn" aria-label="Dark">🌙</button>
      </div>
    </div>
    <!-- NOTE: Actions bar (Buy/Sell/Valuation/Tools) removed as per request -->
  </header>

  <main class="wrap">
    <!-- Tabs (only Cars/Bikes/Scooters, as requested) -->
    <div class="tabs" role="tablist">
      <button class="tab active" data-type="cars" role="tab">Cars</button>
      <button class="tab" data-type="bikes" role="tab">Bikes</button>
      <button class="tab" data-type="scooters" role="tab">Scooters</button>
    </div>

    <!-- Listing -->
    <div id="list" class="grid" aria-live="polite"></div>
  </main>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" aria-hidden="true">
    <img id="lbImg" class="lb-img" alt="zoom">
    <button class="navbtn prev" id="lbPrev" aria-label="Prev">‹</button>
    <button class="navbtn next" id="lbNext" aria-label="Next">›</button>
    <button class="closebtn" id="lbClose" aria-label="Close">✕</button>
  </div>

  <div id="toast" class="toast">Saved</div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // ===== Config =====
    const SUPABASE_URL='https://wbjwvxckbfkutqqbgupq.supabase.co';
    const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indiand2eGNrYmZrdXRxcWJndXBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4NzU3NDEsImV4cCI6MjA2OTQ1MTc0MX0.u_zwikgAryhF5Ccv5yOvjq20hzxE5tbYfKI04uTnNXw';
    const BUCKET='vehicals';
    const INVENTORY_ROOT='inventory'; // cars/bikes/scooters under this

    const sb=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

    // ===== i18n (labels used on this page) =====
    const I18N = {
      en:{'btn.wishlist':'♡ Wishlist','btn.wishadded':'♥ Wishlist','btn.enquire':'Inquiry Now'},
      hi:{'btn.wishlist':'♡ विशलिस्ट','btn.wishadded':'♥ विशलिस्ट','btn.enquire':'इन्क्वायरी करें'},
      mr:{'btn.wishlist':'♡ विशलिस्ट','btn.wishadded':'♥ विशलिस्ट','btn.enquire':'इनक्वायरी करा'}
    };
    function lang(){return localStorage.getItem('lang')||'en'}
    function t(k){return (I18N[lang()]&&I18N[lang()][k])||(I18N.en[k]||k)}
    const langSeg = document.getElementById('langSeg');
    langSeg.addEventListener('click',e=>{
      if(e.target.tagName==='BUTTON'){ localStorage.setItem('lang', e.target.dataset.lang);
        [...langSeg.querySelectorAll('button')].forEach(b=>b.classList.toggle('active', b===e.target));
        render(currentType); showToast('Language: '+e.target.dataset.lang.toUpperCase());
      }
    });

    // Dark
    const DKEY='sw.dark', darkBtn=document.getElementById('darkToggle');
    function applyDark(v){ document.documentElement.style.colorScheme=v?'dark':'light';
      localStorage.setItem(DKEY,v?'1':'0'); darkBtn.textContent=v?'🌙':'☀️';}
    darkBtn.addEventListener('click',()=>applyDark(!(localStorage.getItem(DKEY)==='1')));
    applyDark(localStorage.getItem(DKEY)==='1');

    // Toast
    function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');
      clearTimeout(window.__to);window.__to=setTimeout(()=>t.classList.remove('show'),1400)}

    // Supabase helpers
    const purl = (path)=> sb.storage.from(BUCKET).getPublicUrl(path).data?.publicUrl || '';
    async function listFolders(prefix){
      const {data,error}=await sb.storage.from(BUCKET).list(prefix,{limit:1000});
      if(error) return [];
      return (data||[]).filter(x=>x && !x.name.includes('.')).map(x=>x.name);
    }
    async function readMeta(path){
      const {data,error}=await sb.storage.from(BUCKET).download(path);
      if(error) return null;
      try{ return JSON.parse(await data.text()); }catch{ return null; }
    }
    async function listImages(dir){
      const {data,error}=await sb.storage.from(BUCKET).list(dir,{limit:1000});
      if(error) return [];
      return (data||[]).filter(o=>/\.(jpg|jpeg|png|webp)$/i.test(o.name)).map(o=>`${dir}/${o.name}`);
    }

    // Build card
    function wishKey(slug){ return `sw.wish.${slug}`; }
    function cardHTML(v){
      const wLabel = localStorage.getItem(wishKey(v.slug))==='1' ? t('btn.wishadded') : t('btn.wishlist');
      const waLink = `https://wa.me/919822292955?text=${encodeURIComponent(
        `Inquiry: ${v.title||v.slug} | Price: ${v.price||''} | Type: ${v.type||''}`
      )}`;
      const brandLine = [v.brand?.toUpperCase()||'', v.fuel||''].filter(Boolean).join(' • ');
      const metaLine = [v.year||'', v.km?`${v.km} km`:'' , v.location||''].filter(Boolean).join(' • ');
      return `
        <article class="card">
          <div class="gallery" data-slug="${v.slug}">
            <img class="main-img" src="${v.images[0]||''}" alt="${v.title||''}">
            <div class="thumbs">
              ${v.images.map((u,i)=>`<img src="${u}" data-idx="${i}" class="${i===0?'active':''}" alt="thumb ${i+1}">`).join('')}
            </div>
          </div>
          <div class="body">
            <div class="meta"><span class="pill">${(v.type||'').toUpperCase()}</span><span class="price">${v.price||''}</span></div>
            <h4 class="title">${v.title||v.slug||''}</h4>
            <div class="meta">${brandLine}</div>
            <div class="meta">${metaLine}</div>
            <div class="desc">${v.description||''}</div>
            <div class="actions-row">
              <button class="btn wish" data-wish="${v.slug}">${wLabel}</button>
              <a class="btn primary" target="_blank" rel="noopener" href="${waLink}">${t('btn.enquire')}</a>
            </div>
          </div>
        </article>`;
    }

    // Lightbox
    const lb = document.getElementById('lightbox'), lbImg = document.getElementById('lbImg');
    let lbList=[], lbIdx=0;
    function openLB(list, idx=0){ lbList=list; lbIdx=idx; lbImg.src=lbList[lbIdx]||''; lb.classList.add('show'); lb.setAttribute('aria-hidden','false'); }
    function closeLB(){ lb.classList.remove('show'); lb.setAttribute('aria-hidden','true'); }
    function nextLB(){ if(!lbList.length) return; lbIdx=(lbIdx+1)%lbList.length; lbImg.src=lbList[lbIdx]; }
    function prevLB(){ if(!lbList.length) return; lbIdx=(lbIdx-1+lbList.length)%lbList.length; lbImg.src=lbList[lbIdx]; }
    document.getElementById('lbClose').onclick=closeLB;
    document.getElementById('lbNext').onclick=nextLB;
    document.getElementById('lbPrev').onclick=prevLB;
    lb.addEventListener('click',e=>{ if(e.target===lb) closeLB(); });
    window.addEventListener('keydown',e=>{ if(lb.classList.contains('show')){ if(e.key==='Escape') closeLB(); if(e.key==='ArrowRight') nextLB(); if(e.key==='ArrowLeft') prevLB(); } });

    // Render
    const list = document.getElementById('list');
    let currentType='cars';
    async function render(type=currentType){
      currentType=type;
      document.querySelectorAll('.tab').forEach(b=>b.classList.toggle('active', b.dataset.type===type));
      list.innerHTML = '<div class="muted" style="grid-column:1/-1">Loading…</div>';

      const root = `${INVENTORY_ROOT}/${type}`;
      const folders = await listFolders(root);
      if(!folders.length){ list.innerHTML = '<div class="muted" style="grid-column:1/-1">No items yet</div>'; return; }

      const items=[];
      for(const slug of folders){
        const meta = await readMeta(`${root}/${slug}/meta.json`);
        if(!meta) continue;
        let imgs = await listImages(`${root}/${slug}`);
        // enforce limits
        const max = (type==='cars') ? 20 : 10;
        imgs = imgs.filter(p=>/\.(jpg|jpeg|png|webp)$/i.test(p)).slice(0, max).map(p=>purl(p));
        items.push({slug, images:imgs, type:type.slice(0,-1), ...meta});
      }
      // newest first
      items.sort((a,b)=> (b.updatedAt||'').localeCompare(a.updatedAt||''));

      list.innerHTML='';
      for(const v of items){
        const holder = document.createElement('div');
        holder.innerHTML = cardHTML(v);
        const card = holder.firstElementChild;

        // thumbs click
        const g = card.querySelector('.gallery');
        const main = g.querySelector('.main-img');
        const thumbs = g.querySelectorAll('.thumbs img');
        thumbs.forEach(ti=>{
          ti.addEventListener('click',()=>{
            thumbs.forEach(x=>x.classList.remove('active'));
            ti.classList.add('active');
            main.src = v.images[Number(ti.dataset.idx)] || main.src;
          });
        });

        // main click => lightbox
        main.addEventListener('click',()=>{
          const activeIdx = Math.max(0, [...thumbs].findIndex(x=>x.classList.contains('active')));
          openLB(v.images, activeIdx);
        });

        // wishlist
        const wbtn = card.querySelector('[data-wish]');
        if(localStorage.getItem(wishKey(v.slug))==='1'){ wbtn.classList.add('active'); wbtn.textContent = t('btn.wishadded'); }
        wbtn.addEventListener('click',()=>{
          const key=wishKey(v.slug);
          const cur = localStorage.getItem(key)==='1';
          localStorage.setItem(key, cur?'0':'1');
          wbtn.classList.toggle('active', !cur);
          wbtn.textContent = t(cur ? 'btn.wishlist' : 'btn.wishadded');
          showToast(cur ? 'Removed from wishlist' : 'Added to wishlist');
        });

        list.appendChild(card);
      }
    }

    // Tab clicks
    document.querySelectorAll('.tab').forEach(b=> b.addEventListener('click', ()=>render(b.dataset.type)));

    // Init
    render('cars'); // default
  </script>
</body>
</html>
