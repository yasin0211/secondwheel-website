<!-- ================== SECOND WHEEL : BUY PAGE (FINAL) ================== -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Second Wheel | Buy Vehicles</title>

<style>
body{margin:0;font-family:system-ui;background:#f7f8fb;color:#111}
.wrap{max-width:1200px;margin:auto;padding:16px}
h2{margin:16px 0}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:14px}

.card{background:#fff;border-radius:16px;box-shadow:0 8px 20px rgba(0,0,0,.08);overflow:hidden}
.slider{display:flex;overflow-x:auto;scroll-snap-type:x mandatory}
.slider img{width:100%;height:220px;object-fit:cover;scroll-snap-align:start;cursor:pointer}
.slider::-webkit-scrollbar{display:none}

.badge{position:absolute;top:10px;left:10px;background:#f59e0b;
color:#111;font-weight:700;font-size:12px;padding:4px 8px;border-radius:999px}

.body{padding:12px}
.title{font-weight:800}
.meta{font-size:13px;color:#555;margin:6px 0}
.price{font-size:18px;font-weight:800;margin:6px 0}
.desc{font-size:14px;color:#333;white-space:pre-wrap}
.actions{display:flex;gap:8px;margin-top:10px}
.btn{padding:8px 12px;border-radius:999px;border:none;cursor:pointer}
.primary{background:#f59e0b}
.whatsapp{background:#22c55e;color:#fff}

/* Lightbox */
#lightbox{position:fixed;inset:0;background:rgba(0,0,0,.85);
display:none;align-items:center;justify-content:center;z-index:50}
#lightbox img{max-width:90%;max-height:90%}
</style>
</head>

<body>
<div class="wrap">

<h2>‚≠ê Featured Vehicles</h2>
<div id="featured" class="grid"></div>

<h2>üöó All Vehicles</h2>
<div id="all" class="grid"></div>

</div>

<div id="lightbox" onclick="this.style.display='none'">
  <img id="lbImg">
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
/* SUPABASE */
const SUPABASE_URL="https://wbjwvxckbfkutqqbgupq.supabase.co";
const SUPABASE_KEY="YOUR_PUBLIC_ANON_KEY";
const BUCKET="vehicals";
const sb=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

const featuredBox=document.getElementById("featured");
const allBox=document.getElementById("all");
const lb=document.getElementById("lightbox");
const lbImg=document.getElementById("lbImg");

/* HELPERS */
function pub(path){
  return sb.storage.from(BUCKET).getPublicUrl(path).data.publicUrl;
}
async function list(path){
  const {data}=await sb.storage.from(BUCKET).list(path);
  return data||[];
}
function openImg(src){lbImg.src=src;lb.style.display="flex"}

async function loadType(type){
  const folders=await list(type);
  for(let f of folders){
    const metaUrl=pub(`${type}/${f.name}/meta.json`);
    const r=await fetch(metaUrl); if(!r.ok) continue;
    const m=await r.json();

    const imgs=(await list(`${type}/${f.name}`))
      .filter(x=>!x.name.endsWith(".json"))
      .map(x=>pub(`${type}/${f.name}/${x.name}`));

    const card=document.createElement("div");
    card.className="card";

    const slider=document.createElement("div");
    slider.className="slider";
    imgs.forEach(i=>{
      const im=document.createElement("img");
      im.src=i; im.onclick=()=>openImg(i);
      slider.appendChild(im);
    });

    const body=document.createElement("div");
    body.className="body";
    body.innerHTML=`
      <div class="title">${m.title} ${m.model||""}</div>
      <div class="meta">${m.brand} ‚Ä¢ ${m.year} ‚Ä¢ ${m.fuel}</div>
      <div class="price">‚Çπ${m.price}</div>
      <div class="desc">${m.description||""}</div>
      <div class="actions">
        <a class="btn whatsapp" target="_blank"
        href="https://wa.me/919822292955?text=Interested in ${m.title}">
        WhatsApp</a>
      </div>`;

    card.appendChild(slider);
    card.appendChild(body);

    if(m.featured){
      const b=document.createElement("div");
      b.className="badge"; b.textContent="FEATURED";
      card.style.position="relative";
      card.appendChild(b);
      featuredBox.appendChild(card.cloneNode(true));
    }

    allBox.appendChild(card);
  }
}

/* LOAD */
["car","bike","scooter"].forEach(loadType);
</script>
</body>
</html>
