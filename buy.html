<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Buy Used Cars in Satara | Second Wheel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Buy verified used cars in Satara. Best price, RC transfer, doorstep service.">

<style>
body{margin:0;font-family:system-ui;background:#f7f8fb}

/* HEADER */
header{
  position:sticky;top:0;z-index:20;
  background:#fff;border-bottom:1px solid #ddd
}
.wrap{max-width:1200px;margin:auto;padding:14px}
.row{display:flex;justify-content:space-between;align-items:center;gap:10px}
.logo{display:flex;align-items:center;gap:10px;font-weight:900}
.logo img{height:40px}

/* FILTERS */
.filters{display:grid;gap:10px;margin-top:12px}
@media(min-width:700px){.filters{grid-template-columns:2fr 1fr 1fr 1fr}}

input,select{
  padding:10px;border-radius:10px;border:1px solid #ccc
}

/* SLIDER */
.slider-box{
  grid-column:1/-1;
  background:#fff;
  padding:12px;
  border-radius:14px;
  box-shadow:0 6px 14px rgba(0,0,0,.08)
}
.range-values{
  display:flex;
  justify-content:space-between;
  font-weight:900;
  margin-bottom:6px
}

/* GRID */
.grid{display:grid;gap:16px;margin-top:16px}
@media(min-width:700px){.grid{grid-template-columns:repeat(3,1fr)}}

/* CARD */
.card{
  background:#fff;border-radius:16px;
  overflow:hidden;
  box-shadow:0 10px 20px rgba(0,0,0,.1);
  text-decoration:none;color:#111
}
.card img{width:100%;height:180px;object-fit:cover}
.body{padding:12px}
.body h3{margin:0 0 6px;font-size:15px}
.body p{margin:0;font-size:13px;opacity:.7}
.price{font-weight:900;margin-top:6px}

/* EMI */
.emi{
  margin-top:8px;
  font-size:13px;
  font-weight:900;
  background:#f2f4f8;
  padding:6px 10px;
  border-radius:10px;
}

/* EMPTY */
.empty{text-align:center;padding:40px;opacity:.7}

/* STICKY CALL */
.sticky{
  position:fixed;
  bottom:16px;
  right:16px;
  z-index:99
}
.sticky a{
  padding:14px 18px;
  border-radius:999px;
  font-weight:900;
  text-decoration:none;
  box-shadow:0 10px 20px rgba(0,0,0,.3);
  background:#111;color:#fff
}
</style>
</head>

<body>

<!-- HEADER -->
<header>
  <div class="wrap">
    <div class="row">
      <div class="logo">
        <img src="https://wbjwvxckbfkutqqbgupq.supabase.co/storage/v1/object/public/vehicals/logo.png">
        SECOND WHEEL
      </div>
      <a href="https://wa.me/919822292955"
         style="background:#25D366;padding:10px 18px;border-radius:999px;font-weight:800;color:#111;text-decoration:none">
        WhatsApp
      </a>
    </div>

    <!-- FILTERS -->
    <div class="filters">
      <input id="q" placeholder="Search car / brand">
      <select id="brand"><option value="">All Brands</option></select>
      <select id="sort">
        <option value="">Sort</option>
        <option value="price-low">Price: Low â†’ High</option>
        <option value="price-high">Price: High â†’ Low</option>
        <option value="new">Newest</option>
      </select>
      <span id="count" style="align-self:center;font-weight:900"></span>

      <!-- PRICE SLIDER -->
      <div class="slider-box">
        <div class="range-values">
          <span id="minVal">â‚¹0</span>
          <span id="maxVal">â‚¹0</span>
        </div>
        <input type="range" id="minPrice" step="50000">
        <input type="range" id="maxPrice" step="50000">
      </div>
    </div>
  </div>
</header>

<!-- GRID -->
<main class="wrap">
  <div id="grid" class="grid"></div>
</main>

<!-- STICKY CALL -->
<div class="sticky">
  <a href="tel:+919822292955">ðŸ“ž Call Now</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const sb = supabase.createClient(
  "https://wbjwvxckbfkutqqbgupq.supabase.co",
  "sb_publishable_QjJXmzREzdg3qB6dbfG-1A_0jLQNt66"
);

const grid=document.getElementById("grid");
const q=document.getElementById("q");
const brand=document.getElementById("brand");
const sort=document.getElementById("sort");
const count=document.getElementById("count");
const minP=document.getElementById("minPrice");
const maxP=document.getElementById("maxPrice");
const minVal=document.getElementById("minVal");
const maxVal=document.getElementById("maxVal");

let DATA=[];

const money=n=>"â‚¹"+Number(n).toLocaleString("en-IN");

/* EMI â€“ 18% reducing */
function calcEMI(price, months){
  const r = (18/100)/12;
  const n = months;
  return Math.round(
    price * r * Math.pow(1+r,n) /
    (Math.pow(1+r,n)-1)
  );
}

async function load(){
  const {data}=await sb.from("vehicles")
    .select("*")
    .eq("type","car")
    .neq("status","sold");

  DATA=data||[];
  setupBrands();
  setupPrice();
  render();
}

function setupBrands(){
  const brands=[...new Set(DATA.map(v=>v.brand).filter(Boolean))];
  brand.innerHTML='<option value="">All Brands</option>'+
    brands.map(b=>`<option value="${b}">${b}</option>`).join("");
}

function setupPrice(){
  if(!DATA.length) return;
  const prices=DATA.map(v=>v.price);
  const min=Math.min(...prices);
  const max=Math.max(...prices);
  minP.min=min; minP.max=max; minP.value=min;
  maxP.min=min; maxP.max=max; maxP.value=max;
  minVal.textContent=money(min);
  maxVal.textContent=money(max);
}

function render(){
  let view=[...DATA];

  const term=q.value.toLowerCase().trim();
  if(term){
    view=view.filter(v=>
      v.title.toLowerCase().includes(term) ||
      (v.brand||"").toLowerCase().includes(term)
    );
  }

  if(brand.value) view=view.filter(v=>v.brand===brand.value);

  view=view.filter(v=>v.price>=+minP.value && v.price<=+maxP.value);

  if(sort.value==="price-low") view.sort((a,b)=>a.price-b.price);
  if(sort.value==="price-high") view.sort((a,b)=>b.price-a.price);
  if(sort.value==="new") view.sort((a,b)=>new Date(b.created_at)-new Date(a.created_at));

  count.textContent=view.length+" Cars";

  grid.innerHTML="";
  if(!view.length){
    grid.innerHTML='<div class="empty">No cars found</div>';
    return;
  }

  view.forEach(v=>{
    grid.innerHTML+=`
      <a class="card" href="vehicle.html?vid=${v.vid}">
        <img src="https://wbjwvxckbfkutqqbgupq.supabase.co/storage/v1/object/public/vehicals/car/${v.vid}/cover.jpg"
             onerror="this.src='https://wbjwvxckbfkutqqbgupq.supabase.co/storage/v1/object/public/vehicals/logo.png'">
        <div class="body">
          <h3>${v.title}</h3>
          <p>${v.year} â€¢ ${Number(v.km).toLocaleString("en-IN")} km</p>
          <div class="price">${money(v.price)}</div>
          <div class="emi">EMI: ${money(calcEMI(v.price,36))} / month</div>
        </div>
      </a>
    `;
  });
}

[minP,maxP].forEach(r=>r.oninput=()=>{
  if(+minP.value>+maxP.value) minP.value=maxP.value;
  minVal.textContent=money(minP.value);
  maxVal.textContent=money(maxP.value);
  render();
});

[q,brand,sort].forEach(el=>el.oninput=render);

load();
</script>

</body>
</html>
