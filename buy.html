<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Second Wheel — Buy</title>
  <meta name="theme-color" content="#111827" />
  <style>
    :root{
      --bg:#0b0f17; --card:#121826; --muted:#9aa3b2; --text:#e5e7eb;
      --brand:#f59e0b; --ink:#111; --line:rgba(255,255,255,.10);
      --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);
         font:14px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial}
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:18px}
    header{position:sticky;top:0;z-index:10;background:rgba(11,15,23,.7);backdrop-filter:blur(12px);
      border-bottom:1px solid rgba(255,255,255,.08)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
    .tabs{display:flex;gap:8px;align-items:center}
    .tab{padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#0f1522;cursor:pointer}
    .tab.active{background:linear-gradient(180deg,#f59e0b,#b45309);color:#111;border-color:transparent}
    h1{font-size:20px;margin:0}
    .section{margin-top:18px}
    .section-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:720px){ .grid{grid-template-columns:repeat(2,1fr)} }
    @media(min-width:1000px){ .grid{grid-template-columns:repeat(3,1fr)} }
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;overflow:hidden;box-shadow:var(--shadow)}
    .thumb{width:100%;height:240px;object-fit:cover;display:block}
    @media(min-width:720px){ .thumb{height:220px} }
    .body{padding:12px}
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between}
    .muted{color:var(--muted)}
    .badge{display:inline-block;background:rgba(255,255,255,.08);border:1px solid var(--line);
           color:#ffd16b;padding:4px 8px;border-radius:999px;font-size:12px}
    .btn{display:inline-flex;align-items:center;gap:6px;padding:8px 10px;border-radius:10px;
         border:1px solid var(--line);background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,#f59e0b,#b45309);color:#111;border-color:transparent}
    .empty{padding:18px;border:1px dashed var(--line);border-radius:12px;text-align:center;color:var(--muted)}
    .foot{margin-top:18px;text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <h1>Buy Vehicles</h1>
      <div class="tabs" id="typeTabs">
        <button class="tab active" data-type="all">All</button>
        <button class="tab" data-type="car">Car</button>
        <button class="tab" data-type="bike">Bike</button>
        <button class="tab" data-type="scooter">Scooter</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="section">
      <div class="section-head">
        <div style="display:flex;align-items:center;gap:8px">
          <span class="badge">Featured</span>
          <strong>Latest picks</strong>
        </div>
      </div>
      <div id="grid" class="grid">
        <div class="empty">Loading…</div>
      </div>
      <div class="foot">© 2025 Second Wheel</div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // ---- Supabase config (ready to use) ----
    const SUPABASE_URL='https://wbjwvxckbfkutqqbgupq.supabase.co';
    const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indiand2eGNrYmZrdXRxcWJndXBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4NzU3NDEsImV4cCI6MjA2OTQ1MTc0MX0.u_zwikgAryhF5Ccv5yOvjq20hzxE5tbYfKI04uTnNXw';
    const BUCKET='vehicals';
    const FOLDER='featured';
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // ---- Wishlist (localStorage) ----
    const WL_KEY='secondwheel_wishlist';
    const getWL = ()=>{ try{return new Set(JSON.parse(localStorage.getItem(WL_KEY)||'[]'));}catch(e){return new Set();}};
    const saveWL = (set)=> localStorage.setItem(WL_KEY, JSON.stringify([...set]));
    const wlText = (vid)=> getWL().has(vid) ? '♥ In wishlist' : '♡ Wishlist';
    function toggleWL(vid, btn){
      const s=getWL();
      if(s.has(vid)){s.delete(vid);btn.textContent='♡ Wishlist';}
      else{s.add(vid);btn.textContent='♥ In wishlist';}
      saveWL(s);
    }

    // ---- Helpers ----
    function publicUrl(path){ const {data}=sb.storage.from(BUCKET).getPublicUrl(path); return data?.publicUrl || ''; }
    async function firstImage(vid){
      const {data}=await sb.storage.from(BUCKET).list(`${FOLDER}/${vid}`,{limit:100});
      const img=(data||[]).find(o=>/\.(jpg|jpeg|png|webp)$/i.test(o.name));
      return img? publicUrl(`${FOLDER}/${vid}/${img.name}`) : '';
    }
    async function readMeta(vid){
      const {data,error}=await sb.storage.from(BUCKET).download(`${FOLDER}/${vid}/meta.json`);
      if(error) return null;
      try{ return JSON.parse(await data.text()); }catch(e){ return null; }
    }

    // ---- Render ----
    const grid = document.getElementById('grid');
    let ALL = []; // cached items
    let CURR_TYPE = 'all';

    function render(){
      const items = ALL.filter(v => CURR_TYPE==='all' ? true : (v.type||'').toLowerCase()===CURR_TYPE);
      if(!items.length){ grid.innerHTML = '<div class="empty">No items yet</div>'; return; }
      grid.innerHTML='';
      for(const v of items){
        const msg = encodeURIComponent(`Hi, I'm interested in ${v.title||''} (${v.brand||''}) — Price: ${v.price||''}`);
        const wa = `https://wa.me/?text=${msg}`; // opens WhatsApp and lets user pick contact
        const div = document.createElement('div');
        div.className='card';
        div.innerHTML = `
          <img class="thumb" src="${v.img||''}" alt="${v.title||v.vid}">
          <div class="body">
            <div class="badge">Featured</div>
            <h3 style="margin:8px 0 4px">${v.title||''}</h3>
            <div class="muted">${v.brand||''}</div>
            <div class="row" style="margin-top:6px">
              <div class="muted">${v.year||''} • ${v.km||''} km</div>
              <div><strong>${v.price||''}</strong></div>
            </div>
            <div class="row" style="margin-top:8px">
              <button class="btn wlBtn">${wlText(v.vid)}</button>
              <a class="btn primary" href="${wa}" target="_blank" rel="noopener">Inquiry Now</a>
            </div>
          </div>`;
        div.querySelector('.wlBtn').addEventListener('click', (e)=> toggleWL(v.vid, e.currentTarget));
        grid.appendChild(div);
      }
    }

    // ---- Load featured from Supabase ----
    async function loadFeatured(){
      grid.innerHTML='<div class="empty">Loading…</div>';
      const {data,error}=await sb.storage.from(BUCKET).list(FOLDER,{limit:200});
      if(error){ grid.innerHTML='<div class="empty">Failed to load</div>'; return; }
      const folders=(data||[]).filter(x=>x && !/\./.test(x.name)); // only subfolders (VIDs)
      const items = await Promise.all(folders.map(async f=>{
        const [meta,img] = await Promise.all([readMeta(f.name), firstImage(f.name)]);
        if(!meta) return null;
        return { vid:f.name, ...meta, img };
      }));
      ALL = items.filter(Boolean).sort((a,b)=>(b.updatedAt||'').localeCompare(a.updatedAt||''));
      render();
    }

    // ---- Type tabs ----
    document.getElementById('typeTabs').addEventListener('click', (e)=>{
      const b = e.target.closest('.tab'); if(!b) return;
      document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      CURR_TYPE = b.dataset.type;
      render();
    });

    // init
    loadFeatured();
  </script>
</body>
</html>
