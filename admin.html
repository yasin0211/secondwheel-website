<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Second Wheel – Admin Panel</title>

<style>
body{margin:0;font-family:system-ui;background:#f7f8fb}
.wrap{max-width:1200px;margin:auto;padding:16px}
.card{background:#fff;border-radius:14px;padding:16px;margin-bottom:16px;
box-shadow:0 8px 20px rgba(0,0,0,.06)}
input,textarea,select{width:100%;padding:10px;border-radius:8px;
border:1px solid #d1d5db;margin-bottom:10px}
button{padding:10px 14px;border-radius:8px;border:none;cursor:pointer}
.primary{background:#f59e0b}
.secondary{background:#2563eb;color:#fff}
.danger{background:#ef4444;color:#fff}

.slider{position:relative;overflow:hidden;border-radius:12px}
.track{display:flex;transition:.3s}
.slide{min-width:100%;position:relative}
.slide img{width:100%;height:240px;object-fit:cover;cursor:zoom-in}
.slide button{position:absolute;top:8px;right:8px}

.dots{text-align:center;margin-top:6px}
.dot{display:inline-block;width:8px;height:8px;border-radius:50%;
background:#d1d5db;margin:0 3px}
.dot.active{background:#f59e0b}

/* ZOOM MODAL */
.zoom{position:fixed;inset:0;background:rgba(0,0,0,.9);
display:none;align-items:center;justify-content:center;z-index:999}
.zoom img{max-width:95%;max-height:95%}
.zoom span{position:absolute;top:20px;right:20px;
font-size:28px;color:#fff;cursor:pointer}
</style>
</head>

<body>
<div class="wrap">
<h2>Second Wheel – Admin Panel</h2>

<div class="card">
<b id="vidShow"></b><br><br>

<select id="type">
<option value="car">Car</option>
<option value="bike">Bike</option>
<option value="scooter">Scooter</option>
</select>

<input id="brand" placeholder="Brand">
<input id="title" placeholder="Model">
<input id="price" type="number" placeholder="Price">
<textarea id="desc" placeholder="Description"></textarea>

<input type="file" id="images" multiple accept="image/*">
<button class="secondary" onclick="uploadImages()">Upload Images</button>
<button class="primary" onclick="saveVehicle()">Save</button>
</div>

<div class="card">
<h3>Images (Swipe / Tap to Zoom)</h3>
<div class="slider" id="slider">
  <div class="track" id="track"></div>
</div>
<div class="dots" id="dots"></div>
</div>
</div>

<!-- ZOOM VIEW -->
<div class="zoom" id="zoom">
<span onclick="zoom.style.display='none'">✕</span>
<img id="zoomImg">
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL="https://wbjwvxckbfkutqqbgupq.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indiand2eGNrYmZrdXRxcWJndXBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4NzU3NDEsImV4cCI6MjA2OTQ1MTc0MX0.u_zwikgAryhF5Ccv5yOvjq20hzxE5tbYfKI04uTnNXw";
const BUCKET="vehicals";
const sb=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

let VID=Date.now().toString().slice(-8);
vidShow.textContent="VID: "+VID;
let index=0,startX=0;

async function saveVehicle(){
  let meta={vid:VID,type:type.value,brand:brand.value,title:title.value,description:desc.value};
  let b=new Blob([JSON.stringify(meta)],{type:"application/json"});
  await sb.storage.from(BUCKET).upload(type.value+"/"+VID+"/meta.json",b,{upsert:true});
}

async function uploadImages(){
  for(let f of images.files){
    await sb.storage.from(BUCKET)
      .upload(type.value+"/"+VID+"/"+Date.now()+"-"+f.name,f,{upsert:true});
  }
  loadImages();
}

async function loadImages(){
  track.innerHTML=""; dots.innerHTML="";
  let {data}=await sb.storage.from(BUCKET).list(type.value+"/"+VID);
  if(!data) return;
  data=data.filter(x=>!x.name.endsWith("meta.json"));
  data.forEach((f,i)=>{
    let url=sb.storage.from(BUCKET)
      .getPublicUrl(type.value+"/"+VID+"/"+f.name).data.publicUrl;
    let d=document.createElement("div");
    d.className="slide";
    d.innerHTML=`<img src="${url}" onclick="openZoom('${url}')">`;
    track.appendChild(d);
    dots.innerHTML+=`<span class="dot ${i==0?'active':''}"></span>`;
  });
  update();
}

function update(){
  track.style.transform=`translateX(-${index*100}%)`;
  [...dots.children].forEach((d,i)=>d.classList.toggle("active",i===index));
}

slider.addEventListener("touchstart",e=>startX=e.touches[0].clientX);
slider.addEventListener("touchend",e=>{
  let dx=e.changedTouches[0].clientX-startX;
  if(dx<-50&&index<track.children.length-1) index++;
  if(dx>50&&index>0) index--;
  update();
});

function openZoom(src){
  zoomImg.src=src;
  zoom.style.display="flex";
}
</script>
</body>
</html>
