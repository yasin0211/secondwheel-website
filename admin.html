<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Second Wheel — Admin (Featured & Inventory Manager)</title>
<meta name="theme-color" content="#ffffff"/>

<style>
/* ===== SAME CSS AS YOUR ORIGINAL (UNCHANGED) ===== */
:root{
  --bg:#f7f8fb; --card:#ffffff; --text:#0b0f17; --muted:#5b667a;
  --brand:#f59e0b; --ok:#22c55e; --danger:#ef4444; --line:rgba(0,0,0,.12);
  --elev:0 8px 20px rgba(0,0,0,.06);
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font:14px/1.55 system-ui}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line)}
.wrap{max-width:1200px;margin:auto;padding:14px}
.panel{background:#fff;border:1px solid var(--line);border-radius:14px;padding:14px}
.btn{padding:10px 14px;border-radius:10px;cursor:pointer}
.primary{background:#f59e0b;border:none}
.danger{background:#ef4444;border:none;color:#fff}
.secondary{background:#2563eb;border:none;color:#fff}
.list{display:grid;gap:8px}
.item{display:grid;grid-template-columns:56px 1fr;gap:10px;padding:8px;border:1px solid var(--line);border-radius:12px}
.thumb{width:56px;height:56px;object-fit:cover;border-radius:8px}
.meta small{color:#6b7280}
</style>
</head>

<body>

<header>
  <div class="wrap">
    <h2>Second Wheel — Admin</h2>
  </div>
</header>

<div class="wrap">

<!-- FEATURED LIST -->
<div class="panel">
  <h3>Featured List</h3>
  <div id="featuredList" class="list"></div>
</div>

<br>

<!-- EDITOR -->
<div class="panel">
  <b id="vidShow">VID: -</b><br><br>

  <input id="brand" placeholder="Brand"><br><br>
  <input id="title" placeholder="Title"><br><br>
  <input id="price" type="number" placeholder="Price"><br><br>
  <input id="year" type="number" placeholder="Year"><br><br>
  <input id="km" type="number" placeholder="KM"><br><br>
  <input id="owner" type="number" placeholder="Owner"><br><br>

  <textarea id="desc" placeholder="Description"></textarea><br><br>

  <label><input id="featured" type="checkbox"> Featured</label><br><br>

  <button id="btnSave" class="btn primary">Save</button>
  <button id="btnDelete" class="btn danger">Delete</button>

  <div id="status"></div>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
/* ===== SUPABASE ===== */
var SUPABASE_URL = 'https://wbjwvxckbfkutqqbgupq.supabase.co';
var SUPABASE_KEY = 'YOUR_ANON_KEY';
var BUCKET = 'vehicals';
var sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* ===== ELEMENTS ===== */
function $(id){ return document.getElementById(id); }
var brand=$('brand'), title=$('title'), price=$('price'),
    year=$('year'), km=$('km'), owner=$('owner'),
    desc=$('desc'), featured=$('featured'),
    featuredList=$('featuredList'), statusEl=$('status'),
    vidShow=$('vidShow');

/* ===== VEHICLE ID – ONLY NUMBER ===== */
function makeVID(){
  return Date.now().toString().slice(-8);
}
var CURRENT_VID = makeVID();
vidShow.textContent = 'VID: ' + CURRENT_VID;

/* ===== WRITE META (FIXED) ===== */
async function writeMeta(){

  if(owner.value < 1 || owner.value > 5){
    statusEl.textContent = 'Owner must be between 1 and 5';
    return;
  }
  if(price.value <= 0 || year.value < 1990){
    statusEl.textContent = 'Enter valid price & year';
    return;
  }

  var meta = {
    vid: CURRENT_VID,
    brand: brand.value.trim().toUpperCase(),
    title: title.value.trim(),
    price: Number(price.value),
    year: Number(year.value),
    km: Number(km.value),
    owner: Number(owner.value),
    description: desc.value.trim() || (year.value+' • '+km.value+' km • Owner '+owner.value),
    updatedAt: new Date().toISOString()
  };

  var blob = new Blob([JSON.stringify(meta,null,2)],{type:'application/json'});
  await sb.storage.from(BUCKET).upload('car/'+CURRENT_VID+'/meta.json', blob, {upsert:true});

  if(featured.checked){
    await sb.storage.from(BUCKET).upload('featured/'+CURRENT_VID+'/meta.json', blob, {upsert:true});
  }

  statusEl.textContent = 'Saved ✓';
  loadFeatured();
}

/* ===== LOAD FEATURED LIST WITH SHORT DESCRIPTION ===== */
async function loadFeatured(){
  featuredList.innerHTML='';
  var { data } = await sb.storage.from(BUCKET).list('featured');

  if(!data) return;

  for(let f of data){
    let res = await fetch(sb.storage.from(BUCKET).getPublicUrl('featured/'+f.name+'/meta.json').data.publicUrl);
    if(!res.ok) continue;
    let m = await res.json();

    let div = document.createElement('div');
    div.className='item';
    div.innerHTML = `
      <div class="meta">
        <b>${m.title}</b>
        <small>${m.brand} • ₹${m.price}</small>
        <small style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
          ${m.description}
        </small>
      </div>`;
    featuredList.appendChild(div);
  }
}

$('btnSave').onclick = writeMeta;
loadFeatured();
</script>

</body>
</html>
