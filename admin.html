
<!DOCTYPE html>
<html>
<head>
  <title>Second Wheel – Admin Upload</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      padding: 20px;
    }
    .form-container {
      background: white;
      max-width: 400px;
      margin: auto;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }
    h2 { text-align: center; color: #444; }
    label { display: block; margin-top: 12px; font-weight: bold; }
    select, textarea, input[type="file"], button {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background: #ff8800;
      color: white;
      font-weight: bold;
      border: none;
      margin-top: 20px;
      cursor: pointer;
    }
    .success {
      color: green;
      text-align: center;
      margin-top: 15px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="form-container">
    <h2>Admin Vehicle Upload</h2>
    <label>Category</label>
    <select id="category" required>
      <option value="">Select Category</option>
      <option value="Car">Car</option>
      <option value="Bike">Bike</option>
      <option value="Scooter">Scooter</option>
      <option value="EV">EV</option>
    </select>

    <label>Description</label>
    <textarea id="description" rows="4" placeholder="e.g. Swift 2015, MH12, 2nd Owner, ₹2.45L, Insurance Valid" required></textarea>

    <label>Vehicle Image</label>
    <input type="file" id="image" accept="image/*" required />

    <button id="uploadBtn">Upload</button>
    <div class="success" id="successMsg"></div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const supabaseUrl = 'https://wbjwvxckbfkutqqbgupq.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indiand2eGNrYmZrdXRxcWJndXBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4NzU3NDEsImV4cCI6MjA2OTQ1MTc0MX0.u_zwikgAryhF5Ccv5yOvjq20hzxE5tbYfKI04uTnNXw'
    const supabase = createClient(supabaseUrl, supabaseKey)

    document.getElementById('uploadBtn').addEventListener('click', uploadVehicle)

    async function uploadVehicle() {
      const category = document.getElementById('category').value
      const description = document.getElementById('description').value
      const imageFile = document.getElementById('image').files[0]
      const successMsg = document.getElementById('successMsg')
      successMsg.textContent = ''

      if (!category || !description || !imageFile) {
        alert('Please fill all fields and select an image.')
        return
      }

      const fileName = `vehicle-${Date.now()}-${imageFile.name}`
      const { error: uploadError } = await supabase
        .storage.from('vehicals')
        .upload(fileName, imageFile)

      if (uploadError) {
        alert('❌ Image upload failed.')
        console.error(uploadError)
        return
      }

      const imageUrl = `${supabaseUrl}/storage/v1/object/public/vehicals/${fileName}`

      const { error: insertError } = await supabase
        .from('vehicles')
        .insert([{ category, description, image_url: imageUrl }])

      if (insertError) {
        alert('❌ Failed to save vehicle data.')
        console.error(insertError)
        return
      }

      successMsg.textContent = '✅ Vehicle uploaded successfully!'
      document.getElementById('category').value = ''
      document.getElementById('description').value = ''
      document.getElementById('image').value = ''
    }
  </script>
</body>
</html>
