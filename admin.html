<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Second Wheel – Admin Panel</title>

<style>
body{margin:0;font-family:system-ui;background:#f7f8fb}
.login, .admin{max-width:1100px;margin:auto;padding:20px}
.card{background:#fff;border-radius:14px;padding:16px;margin-bottom:16px;box-shadow:0 10px 25px rgba(0,0,0,.06)}
h2{margin:0 0 10px}
input,textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid #d1d5db;margin-bottom:10px}
button{padding:10px 14px;border-radius:8px;border:none;cursor:pointer}
.primary{background:#f59e0b}
.danger{background:#ef4444;color:#fff}
.list{display:grid;gap:10px}
.item{border:1px solid #e5e7eb;border-radius:10px;padding:10px}
small{color:#6b7280;display:block}
.hidden{display:none}
.top{display:flex;justify-content:space-between;align-items:center}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login card" id="loginBox">
  <h2>Admin Login</h2>
  <input id="user" placeholder="Username">
  <input id="pass" type="password" placeholder="Password">
  <button class="primary" onclick="login()">Login</button>
  <small id="loginErr"></small>
</div>

<!-- ADMIN -->
<div class="admin hidden" id="adminBox">

<div class="top">
  <h2>Second Wheel – Admin</h2>
  <button onclick="logout()">Logout</button>
</div>

<!-- FEATURED LIST -->
<div class="card">
  <h3>Featured Vehicles</h3>
  <div id="featuredList" class="list"></div>
</div>

<!-- VEHICLE FORM -->
<div class="card">
  <b id="vidShow">VID: -</b><br><br>

  <input id="brand" placeholder="Brand">
  <input id="title" placeholder="Model / Title">
  <input id="price" type="number" placeholder="Price">
  <input id="year" type="number" placeholder="Year">
  <input id="km" type="number" placeholder="KM">
  <input id="owner" type="number" placeholder="Owner">

  <textarea id="desc" placeholder="Full Description (Buy page)"></textarea>

  <label><input type="checkbox" id="featured"> Mark as Featured</label><br><br>

  <input type="file" id="images" multiple accept="image/*"><br><br>

  <button class="primary" onclick="saveVehicle()">Save Vehicle</button>
  <button class="danger" onclick="deleteVehicle()">Delete Vehicle</button>

  <small id="status"></small>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
/* ================= CONFIG ================= */
const ADMIN_USER="secondwheel";
const ADMIN_PASS="1008"; // change later

const SUPABASE_URL="https://wbjwvxckbfkutqqbgupq.supabase.co";
const SUPABASE_KEY="YOUR_ANON_KEY";
const BUCKET="vehicals";

const sb=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

/* ================= LOGIN ================= */
function login(){
  if(user.value===ADMIN_USER && pass.value===ADMIN_PASS){
    localStorage.setItem("sw_admin","1");
    loginBox.classList.add("hidden");
    adminBox.classList.remove("hidden");
    init();
  }else{
    loginErr.textContent="Invalid login";
  }
}
function logout(){
  localStorage.removeItem("sw_admin");
  location.reload();
}
if(localStorage.getItem("sw_admin")){
  loginBox.classList.add("hidden");
  adminBox.classList.remove("hidden");
  init();
}

/* ================= UTIL ================= */
function vid(){ return Date.now().toString().slice(-8); }
function shortDesc(t){ return t.length>45?t.slice(0,45)+"…":t; }

let CURRENT_VID=vid();
vidShow.textContent="VID: "+CURRENT_VID;

/* ================= SAVE ================= */
async function saveVehicle(){
  if(owner.value<1||owner.value>5){status.textContent="Owner 1–5";return;}

  let meta={
    vid:CURRENT_VID,
    brand:brand.value.toUpperCase(),
    title:title.value,
    price:+price.value,
    year:+year.value,
    km:+km.value,
    owner:+owner.value,
    description:desc.value,
    updatedAt:new Date().toISOString()
  };

  let blob=new Blob([JSON.stringify(meta,null,2)],{type:"application/json"});
  await sb.storage.from(BUCKET).upload("car/"+CURRENT_VID+"/meta.json",blob,{upsert:true});
  if(featured.checked){
    await sb.storage.from(BUCKET).upload("featured/"+CURRENT_VID+"/meta.json",blob,{upsert:true});
  }

  for(let f of images.files){
    let n=Date.now()+"-"+f.name;
    await sb.storage.from(BUCKET).upload("car/"+CURRENT_VID+"/"+n,f,{upsert:true});
    if(featured.checked){
      await sb.storage.from(BUCKET).upload("featured/"+CURRENT_VID+"/"+n,f,{upsert:true});
    }
  }

  status.textContent="Saved ✓";
  loadFeatured();
}

/* ================= DELETE ================= */
async function deleteVehicle(){
  await sb.storage.from(BUCKET).remove(["car/"+CURRENT_VID,"featured/"+CURRENT_VID]);
  status.textContent="Deleted";
}

/* ================= FEATURED ================= */
async function loadFeatured(){
  featuredList.innerHTML="";
  let {data}=await sb.storage.from(BUCKET).list("featured");
  if(!data) return;

  for(let f of data){
    let url=sb.storage.from(BUCKET)
      .getPublicUrl("featured/"+f.name+"/meta.json").data.publicUrl;
    let r=await fetch(url);
    if(!r.ok)continue;
    let m=await r.json();

    let d=document.createElement("div");
    d.className="item";
    d.innerHTML=`
      <b>${m.title}</b>
      <small>${m.brand} • ₹${m.price}</small>
      <small>${shortDesc(m.description)}</small>
    `;
    featuredList.appendChild(d);
  }
}
function init(){ loadFeatured(); }
</script>

</body>
</html>
