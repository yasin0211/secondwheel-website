<!-- ================== SECOND WHEEL : ADMIN PANEL (FINAL) ================== -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Second Wheel | Admin</title>

<style>
body{margin:0;font-family:system-ui;background:#f3f4f6}
.wrap{max-width:1200px;margin:auto;padding:16px}
.card{background:#fff;border-radius:16px;padding:16px;margin-bottom:16px;
box-shadow:0 8px 20px rgba(0,0,0,.08)}
input,select,textarea{width:100%;padding:10px;border-radius:8px;
border:1px solid #d1d5db;margin-bottom:10px}
button{padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
.primary{background:#f59e0b}
.secondary{background:#2563eb;color:#fff}
.danger{background:#ef4444;color:#fff}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px}

.login{position:fixed;inset:0;background:#111827;
display:flex;align-items:center;justify-content:center}
.hide{display:none}

.imgGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:8px}
.imgGrid div{position:relative}
.imgGrid img{width:100%;height:90px;object-fit:cover;border-radius:8px}
.imgGrid button{position:absolute;top:4px;right:4px}
</style>
</head>

<body>

<div class="login" id="loginBox">
  <div class="card">
    <h3>Admin Login</h3>
    <input id="u" placeholder="Username">
    <input id="p" type="password" placeholder="Password">
    <button class="primary" onclick="login()">Login</button>
    <small id="err"></small>
  </div>
</div>

<div class="wrap hide" id="admin">

<div class="card">
<h3>Add / Edit Vehicle</h3>

<select id="type">
  <option value="car">Car</option>
  <option value="bike">Bike</option>
  <option value="scooter">Scooter</option>
</select>

<div class="grid">
  <input id="brand" placeholder="Brand">
  <input id="title" placeholder="Title">
  <input id="model" placeholder="Model">
  <input id="year" placeholder="Year">
  <input id="km" placeholder="KM">
  <input id="fuel" placeholder="Fuel">
  <input id="price" placeholder="Price">
</div>

<textarea id="desc" placeholder="Description"></textarea>
<label><input type="checkbox" id="featured"> Featured</label>

<input type="file" id="imgs" multiple>
<button class="secondary" onclick="upload()">Upload Images</button>
<button class="primary" onclick="save()">Save</button>

<div id="preview" class="imgGrid"></div>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const ADMIN_USER="secondwheel";
const ADMIN_PASS="1008";

const SUPABASE_URL="https://wbjwvxckbfkutqqbgupq.supabase.co";
const SUPABASE_KEY="YOUR_PUBLIC_ANON_KEY";
const BUCKET="vehicals";
const sb=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

let VID=Date.now().toString().slice(-8);

/* LOGIN */
function login(){
  if(u.value===ADMIN_USER && p.value===ADMIN_PASS){
    loginBox.style.display="none";
    admin.classList.remove("hide");
  }else err.textContent="Wrong login";
}

/* UPLOAD */
async function upload(){
  preview.innerHTML="";
  for(let f of imgs.files){
    const path=`${type.value}/${VID}/${Date.now()}-${f.name}`;
    await sb.storage.from(BUCKET).upload(path,f,{upsert:true});
    showImg(path);
  }
}

/* PREVIEW + DELETE */
function showImg(path){
  const d=document.createElement("div");
  const i=document.createElement("img");
  i.src=sb.storage.from(BUCKET).getPublicUrl(path).data.publicUrl;
  const b=document.createElement("button");
  b.textContent="âœ•"; b.className="danger";
  b.onclick=async()=>{
    await sb.storage.from(BUCKET).remove([path]);
    d.remove();
  };
  d.appendChild(i); d.appendChild(b);
  preview.appendChild(d);
}

/* SAVE META */
async function save(){
  const meta={
    vid:VID,type:type.value,brand:brand.value,title:title.value,
    model:model.value,year:year.value,km:km.value,
    fuel:fuel.value,price:price.value,
    description:desc.value,featured:featured.checked
  };
  const blob=new Blob([JSON.stringify(meta,null,2)],{type:"application/json"});
  await sb.storage.from(BUCKET)
    .upload(`${type.value}/${VID}/meta.json`,blob,{upsert:true});
  if(featured.checked){
    await sb.storage.from(BUCKET)
      .upload(`featured/${VID}/meta.json`,blob,{upsert:true});
  }
  alert("Saved");
  VID=Date.now().toString().slice(-8);
  preview.innerHTML="";
}
</script>
</body>
</html>
