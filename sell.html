<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Second Wheel ‚Äî Sell</title>
<meta name="theme-color" content="#0b0f17"/>
<style>
  :root{ --bg:#0b0f17; --card:#121826; --text:#e5e7eb; --muted:#9aa3b2;
    --brand:#f59e0b; --ok:#22c55e; --line:rgba(255,255,255,.10); --shadow:0 10px 28px rgba(0,0,0,.35); }
  :root[data-theme="light"]{ --bg:#f7f8fb; --card:#ffffff; --text:#0b0f17; --muted:#5b667a; --line:rgba(0,0,0,.12); }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
  a{color:inherit;text-decoration:none}
  img{max-width:100%;display:block}
  .wrap{max-width:920px;margin:0 auto;padding:14px 16px}

  /* Header */
  header{position:sticky;top:0;z-index:20;background:rgba(11,15,23,.78);backdrop-filter:blur(10px);border-bottom:1px solid var(--line)}
  .hrow{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 0}
  .brand{display:flex;align-items:center;gap:10px}
  .brand img{width:48px;height:48px;border-radius:12px;box-shadow:var(--shadow)}
  .brand h1{margin:0;font-size:16px;letter-spacing:.3px}
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.06);cursor:pointer}
  .btn.primary{background:linear-gradient(180deg,#f59e0b,#b45309);color:#111;border:none}
  .btn.ok{background:linear-gradient(180deg,#22c55e,#15803d);color:#111;border:none}
  .btn:active{transform:translateY(1px)}

  /* Steps */
  .steps{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin:10px 0}
  .step{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:10px;display:flex;align-items:center;gap:10px;box-shadow:var(--shadow)}
  .dot{width:28px;height:28px;border-radius:999px;display:grid;place-items:center;background:rgba(255,255,255,.08);border:1px solid var(--line);font-weight:800}
  .step.active .dot{background:var(--brand);color:#111;border-color:transparent}
  .step.done .dot{background:var(--ok);color:#111;border-color:transparent}
  .step small{color:var(--muted);display:block;margin-top:2px}

  /* Cards */
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);padding:14px;margin-top:12px}
  h2{margin:0 0 8px;font-size:18px}
  label{display:block;margin:10px 0 6px;color:var(--muted);font-weight:700}
  input,select,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid var(--line);background:#0f1626;color:var(--text);outline:none}
  :root[data-theme="light"] input,:root[data-theme="light"] select,:root[data-theme="light"] textarea{background:#f2f4f8;color:#111}
  input:focus,select:focus,textarea:focus{border-color:#3b82f6}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (max-width:640px){ .grid2{grid-template-columns:1fr} }
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{padding:8px 12px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.06);cursor:pointer}
  .chip.active{background:var(--brand);color:#111;border-color:transparent;font-weight:800}
  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .hidden{display:none !important}
  .note{color:var(--muted);font-size:12px}
  .price{font-size:24px;font-weight:900}

  /* Toast */
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:#111827;color:#e5e7eb;border:1px solid var(--line);padding:10px 14px;border-radius:10px;box-shadow:var(--shadow);opacity:0;pointer-events:none;transition:opacity .25s}
  .toast.show{opacity:1}
</style>
</head>
<body>
<header>
  <div class="wrap hrow">
    <div class="brand">
      <img src="https://wbjwvxckbfkutqqbgupq.supabase.co/storage/v1/object/public/vehicals/logo.png" alt="Second Wheel logo">
      <h1>SECOND WHEEL</h1>
    </div>
    <button id="themeBtn" class="btn" aria-label="Toggle theme">üåô</button>
  </div>
</header>

<main class="wrap">
  <!-- Step indicator -->
  <div class="steps">
    <div class="step active" id="s1step"><div class="dot">1</div><div><b>Vehicle Details</b><small>RC / Insurance / PUC</small></div></div>
    <div class="step" id="s2step"><div class="dot">2</div><div><b>Customer Details</b><small>Verify phone</small></div></div>
    <div class="step" id="s3step"><div class="dot">3</div><div><b>Instant Valuation</b><small>Doorstep slot</small></div></div>
  </div>

  <!-- STEP 1 -->
  <section class="card" id="s1">
    <h2>Vehicle Details</h2>
    <div class="grid2">
      <div><label>Vehicle Number <small class="note">(MH12 / MH14 / MH11)</small></label><input id="vehNumber" placeholder="MH12 AB 1234" required></div>
      <div><label>Make</label><input id="make" placeholder="Maruti / Hyundai / Honda‚Ä¶" required></div>
      <div><label>Model</label><input id="model" placeholder="Swift / i10 / City‚Ä¶" required></div>
      <div><label>Variant</label><input id="variant" placeholder="VXi / ZDi / Sportz‚Ä¶" required></div>
      <div><label>Colour</label><input id="color" placeholder="White / Silver / Grey‚Ä¶" required></div>
      <div><label>KM Driven</label><input id="km" type="number" inputmode="numeric" placeholder="72000" required></div>
      <div>
        <label>Owner</label>
        <select id="owner" required>
          <option value="">Select</option><option>1st</option><option>2nd</option><option>3rd</option><option>4th+</option>
        </select>
      </div>
      <div>
        <label>Fuel</label>
        <select id="fuel" required>
          <option value="">Select</option>
          <option value="petrol">Petrol</option>
          <option value="diesel">Diesel</option>
          <option value="cng">CNG</option>
          <option value="electric">Electric</option>
        </select>
      </div>
      <div>
        <label>Type</label>
        <select id="type" required>
          <option value="car">Car</option>
          <option value="bike">Bike</option>
          <option value="scooter">Scooter</option>
        </select>
      </div>
      <div><label>Year</label><input id="year" type="number" inputmode="numeric" placeholder="2016" required></div>
    </div>

    <!-- RC & Green Tax: only for 15+ years -->
    <div class="grid2 hidden" id="ageOnlyRow1">
      <div>
        <label>RC / Fitness</label>
        <div class="chips" id="rcChips">
          <span class="chip" data-val="ok">OK</span>
          <span class="chip" data-val="pending">Pending</span>
          <span class="chip" data-val="expired">Expired</span>
        </div>
      </div>
      <div>
        <label>Green Tax</label>
        <div class="chips" id="taxChips">
          <span class="chip" data-val="paid">Paid</span>
          <span class="chip" data-val="due">Due</span>
          <span class="chip" data-val="na">Don‚Äôt know</span>
        </div>
      </div>
    </div>

    <!-- Always visible -->
    <div class="grid2">
      <div>
        <label>Insurance</label>
        <div class="chips" id="insChips">
          <span class="chip" data-val="ok">Valid</span>
          <span class="chip" data-val="expired">Expired</span>
        </div>
      </div>
      <div>
        <label>PUC</label>
        <div class="chips" id="pucChips">
          <span class="chip" data-val="ok">Valid</span>
          <span class="chip" data-val="expired">Expired</span>
        </div>
      </div>
    </div>

    <div class="actions">
      <button id="go2" class="btn primary">Continue</button>
    </div>
  </section>

  <!-- STEP 2 -->
  <section class="card hidden" id="s2">
    <h2>Customer Details</h2>
    <div class="grid2">
      <div><label>Customer Name</label><input id="custName" placeholder="Your name" required></div>
      <div><label>Mobile Number</label><input id="custPhone" placeholder="10-digit" maxlength="10" inputmode="numeric" required></div>
      <div><label>City</label><input id="city" placeholder="Satara" required></div>
      <div><label>Notes (optional)</label><input id="notes" placeholder="Any info‚Ä¶"></div>
    </div>
    <div class="actions">
      <button id="back1" class="btn">Back</button>
      <button id="go3" class="btn primary">Get Instrument Valuation</button>
    </div>
  </section>

  <!-- STEP 3 -->
  <section class="card hidden" id="s3">
    <h2>Instant Valuation</h2>
    <div class="price" id="valPrice">‚Çπ ‚Äî</div>
    <p class="note">* ‡§π‡•á Instant estimate ‡§Ü‡§π‡•á ‚Äî Final price Doorstep Inspection ‡§®‡§Ç‡§§‡§∞ ‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§π‡•ã‡§à‡§≤.</p>

    <div class="grid2">
      <div>
        <label>Pick Inspection Date</label>
        <input type="date" id="datePick">
      </div>
      <div>
        <label>Time Slot</label>
        <select id="timePick">
          <option value="10-1">10am ‚Äì 1pm</option>
          <option value="2-6">2pm ‚Äì 6pm</option>
        </select>
      </div>
    </div>

    <div class="actions">
      <a id="waBtn" class="btn" target="_blank" rel="noopener">WhatsApp</a>
      <button id="saveLead" class="btn ok">Book Doorstep Inspection</button>
    </div>
  </section>
</main>

<div id="toast" class="toast">Saved!</div>

<script>
/* THEME */
(function(){
  const KEY='sw.theme';
  const b=document.getElementById('themeBtn');
  function setT(t){ document.documentElement.setAttribute('data-theme',t); localStorage.setItem(KEY,t); b.textContent=(t==='dark')?'üåô':'‚òÄÔ∏è'; }
  setT(localStorage.getItem(KEY)||'dark');
  b.addEventListener('click',()=> setT((localStorage.getItem(KEY)||'dark')==='dark'?'light':'dark'));
})();

/* HELPERS / STATE */
/* <<< REPLACE THIS WITH YOUR LATEST DEPLOYED WEB APP URL IF YOU REDEPLOY >>> */
const GAS_URL = 'https://script.google.com/macros/s/AKfycbzThwRpJQh2SswZsaPS-AfErMHtB1ajwVXu2-gGCrknf_jGqKmGm4w0vY8tOtZ4BSqwOw/exec';
const VID = (()=> Math.random().toString(36).slice(2,6)+'-'+Date.now().toString(36).slice(-4))();
const $ = id => document.getElementById(id);
const toast = m => { const t=$('toast'); t.textContent=m; t.classList.add('show'); clearTimeout(window.__t); window.__t=setTimeout(()=>t.classList.remove('show'),1400); };

function req(el){ return el && el.value && el.value.toString().trim().length>0; }
function bindChips(id){
  const g=$(id); if(!g) return;
  g.addEventListener('click',e=>{
    const c=e.target.closest('.chip'); if(!c) return;
    g.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
    c.classList.add('active');
  });
}
['rcChips','insChips','pucChips','taxChips'].forEach(bindChips);
function getChip(id){ const g=$(id); if(!g) return null; let v=null; g.querySelectorAll('.chip').forEach(ch=>{ if(ch.classList.contains('active')) v=ch.dataset.val; }); return v; }

/* 15+ YEARS: show/hide RC & Green Tax */
function needsAgeFields(){
  const y=Number($('year').value||0); if(!y) return false;
  const now=(new Date()).getFullYear();
  return (now - y) >= 15;
}
function toggleAgeFields(){
  const show = needsAgeFields();
  $('ageOnlyRow1').classList.toggle('hidden', !show);
  if(!show){
    ['rcChips','taxChips'].forEach(id=>{
      const g=$(id); if(!g) return;
      g.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
    });
  }
}
$('year').addEventListener('input', toggleAgeFields);
document.addEventListener('DOMContentLoaded', toggleAgeFields);

/* STEP NAV */
const s1=$('s1'), s2=$('s2'), s3=$('s3'), s1s=$('s1step'), s2s=$('s2step'), s3s=$('s3step');
function setStep(n){
  [s1,s2,s3].forEach((sec,i)=> sec.classList.toggle('hidden', i!==n-1));
  [s1s,s2s,s3s].forEach((st,i)=>{ st.classList.toggle('active', i===n-1); st.classList.toggle('done', i<n-1); });
  window.scrollTo({top:0, behavior:'smooth'});
}

/* VALIDATION */
function validateStep1(){
  const basic = req($('vehNumber'))&&req($('make'))&&req($('model'))&&req($('variant'))&&req($('color'))&&req($('km'))&&req($('owner'))&&req($('fuel'))&&req($('type'))&&req($('year'));
  if(!basic){ toast('Please complete all Vehicle Details.'); return false; }
  if(needsAgeFields()){
    if(!getChip('rcChips') || !getChip('taxChips')){ toast('Select RC/Fitness & Green Tax status.'); return false; }
  }
  if(!getChip('insChips') || !getChip('pucChips')){ toast('Select Insurance & PUC.'); return false; }
  return true;
}
function validateStep2(){
  const ph=$('custPhone').value.trim();
  const ok=req($('custName')) && /^\d{10}$/.test(ph) && req($('city'));
  if(!ok) toast('Please complete Customer Details correctly.');
  return ok;
}

/* VALUATION */
function calcBase(type,year,fuel,km,makeBrand){
  const now=(new Date()).getFullYear(); const age=Math.max(0,now-(Number(year)||now));
  let base=(type==='car')?450000:(type==='bike'?35000:30000);
  const B=(makeBrand||'').toUpperCase();
  if(type==='car'&&['MARUTI','HYUNDAI','HONDA','TOYOTA'].some(x=>B.includes(x))) base*=1.08;
  if(type==='bike'&&['HERO','BAJAJ','ROYAL ENFIELD'].some(x=>B.includes(x))) base*=1.10;
  if(type==='scooter'&&['HONDA','HERO','TVS'].some(x=>B.includes(x))) base*=1.08;
  if(type==='car'){ if(fuel==='diesel') base*=1.08; if(fuel==='cng') base*=1.05; if(fuel==='electric') base*=1.12; }
  base*=Math.max(0.35,(1-age*0.06));
  const kmx=Number(km)||0; const over=Math.max(0,kmx-(type==='car'?50000:20000)); const blocks=Math.floor(over/(type==='car'?10000:5000));
  base*=(1-blocks*0.02);
  return Math.max(15000,Math.round(base));
}
function docAdjust(base){
  let adj=0; const y=Number($('year').value)||new Date().getFullYear(); const now=(new Date()).getFullYear();
  if((now-y)>=15){ if(getChip('rcChips')!=='ok') adj-=0.10; if(getChip('taxChips')==='due') adj-=0.03; }
  if(getChip('insChips')==='expired') adj-=0.05;
  const min=Math.round(base*(1+adj-0.04)), max=Math.round(base*(1+adj+0.05));
  return {min:Math.max(10000,min), max:Math.max(12000,max)};
}
function makeWaMessage(min,max){
  const parts=[];
  parts.push(`Lead ID: ${VID}`);
  parts.push(`Vehicle: ${$('vehNumber').value} | ${$('make').value} ${$('model').value} ${$('variant').value} (${ $('year').value })`);
  parts.push(`Fuel: ${$('fuel').value.toUpperCase()} | KM: ${$('km').value} | Owner: ${$('owner').value} | Color: ${$('color').value}`);
  if(needsAgeFields()){
    if(getChip('rcChips')) parts.push(`RC/Fitness: ${getChip('rcChips')}`);
    if(getChip('taxChips')) parts.push(`GreenTax: ${getChip('taxChips')}`);
  }
  parts.push(`Insurance: ${getChip('insChips') || '-'}, PUC: ${getChip('pucChips') || '-'}`);
  parts.push(`Estimate: ‚Çπ${min.toLocaleString('en-IN')}‚Äì‚Çπ${max.toLocaleString('en-IN')}`);
  parts.push(`Customer: ${$('custName').value}, ${$('custPhone').value} (${ $('city').value })`);
  return parts.join(' | ');
}
function updateValuation(){
  const base=calcBase($('type').value,$('year').value,$('fuel').value,$('km').value,$('make').value);
  const r=docAdjust(base);
  $('valPrice').textContent='‚Çπ '+r.min.toLocaleString('en-IN')+' ‚Äì ‚Çπ '+r.max.toLocaleString('en-IN');
  $('waBtn').href='https://wa.me/919822292955?text='+encodeURIComponent(makeWaMessage(r.min,r.max));
}

/* SAVE to Google Sheets (Apps Script) ‚Äî no preflight, using form-encoded body */
async function saveLead(){
  const payload={
    vid:VID, name:$('custName').value.trim(), phone:$('custPhone').value.trim(), city:$('city').value.trim(),
    type:$('type').value, brand:$('make').value.trim(), model:$('model').value.trim(), year:$('year').value.trim(),
    fuel:$('fuel').value, km:$('km').value.trim(), reg:$('vehNumber').value.trim(), color:$('color').value.trim(), owner:$('owner').value,
    rcStatus: needsAgeFields()? (getChip('rcChips')||'') : '', insuranceStatus:getChip('insChips')||'',
    greenTax: needsAgeFields()? (getChip('taxChips')||'') : '', puc:getChip('pucChips')||'',
    notes:$('notes').value.trim(), source:'sell-form',
    slotDate:$('datePick').value||'', slotTime:$('timePick').value||''
  };
  try{
    const res = await fetch(GAS_URL, {
      method:'POST',
      body: new URLSearchParams({ payload: JSON.stringify(payload) })
    });
    const j = await res.json().catch(()=>({ok:false}));
    if(j && j.ok){ toast('Saved ‚úì'); return true; }
    toast('Save failed'); return false;
  }catch(e){ console.error(e); toast('Save failed'); return false; }
}

/* Wires */
$('go2').addEventListener('click',()=>{ if(!validateStep1()) return; setStep(2); });
$('back1').addEventListener('click',()=> setStep(1));
$('go3').addEventListener('click',()=>{
  if(!validateStep2()) return;
  updateValuation();
  setStep(3);
  s1s.classList.add('done'); s2s.classList.add('done');
});
$('saveLead').addEventListener('click', async ()=>{
  const ok = await saveLead();
  if(ok) toast('Inspection slot saved');
});
['change','input'].forEach(ev=>{
  ['km','year','fuel','type','make','vehNumber','model','variant','owner','color'].forEach(id=>{
    $(id).addEventListener(ev, ()=>{ if(!s3.classList.contains('hidden')) updateValuation(); });
  });
});
</script>
  <!-- ===== Footer Start ===== -->
<footer style="background:#111; color:#ddd; padding:25px 15px; text-align:center; margin-top:40px;">
  <div style="max-width:1000px; margin:auto; display:flex; flex-wrap:wrap; justify-content:center; gap:20px;">

    <a href="about.html" style="color:#f1c40f; text-decoration:none;">About Us</a>
    <a href="contact.html" style="color:#f1c40f; text-decoration:none;">Contact</a>
    <a href="wishlist.html" style="color:#f1c40f; text-decoration:none;">Wishlist</a>
    <a href="disclaimer.html" style="color:#f1c40f; text-decoration:none;">Disclaimer</a>
    <a href="terms.html" style="color:#f1c40f; text-decoration:none;">Terms & Conditions</a>
    <a href="privacy.html" style="color:#f1c40f; text-decoration:none;">Privacy Policy</a>

  </div>

  <div style="margin-top:15px; font-size:14px;">
    ¬© 2025 <b>Second Wheel - The Car Bazaar</b> | Trusted Vehicles, Smart Deals
  </div>
</footer>
<!-- ===== Footer End ===== -->
</body>
</html>
