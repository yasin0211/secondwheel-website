<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Second Wheel ‚Äî Sell</title>
<meta name="theme-color" content="#0b0f17"/>
<style>
  :root{
    --bg:#0b0f17; --card:#121826; --text:#e5e7eb; --muted:#9aa3b2;
    --brand:#f59e0b; --brand2:#22c55e; --line:rgba(255,255,255,.12);
    --shadow:0 12px 30px rgba(0,0,0,.35); --accent:#3b82f6;
  }
  :root[data-theme="light"]{
    --bg:#f7f8fb; --card:#ffffff; --text:#0b0f17; --muted:#5b667a; --line:rgba(0,0,0,.12);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:1120px;margin:0 auto;padding:14px 16px}
  .hidden{display:none!important}
  .muted{color:var(--muted)}
  .ok{color:#22c55e} .err{color:#f87171}

  /* Header (no navbar) */
  header{position:sticky;top:0;z-index:50;background:rgba(11,15,23,.78);backdrop-filter:blur(10px);border-bottom:1px solid var(--line)}
  .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
  .brand{display:flex;align-items:center;gap:12px}
  .brand img{width:56px;height:56px;border-radius:14px;box-shadow:var(--shadow)}
  .brand h1{margin:0;font-size:16px;letter-spacing:.4px}
  .seg{display:inline-flex;gap:8px;padding:6px;border:1px solid var(--line);border-radius:999px;background:rgba(255,255,255,.06)}
  .seg button{border:0;background:transparent;padding:10px 14px;border-radius:999px;color:var(--text);cursor:pointer}
  .seg button.active{background:var(--brand);color:#111;font-weight:800}
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 16px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.06);cursor:pointer}
  .btn.primary{background:linear-gradient(180deg,#f59e0b,#b45309);color:#111;border:none}
  .btn.success{background:linear-gradient(180deg,#22c55e,#15803d);color:#111;border:none}
  .btn:active{transform:translateY(1px)}

  /* Hero */
  .hero{border-bottom:1px solid var(--line);padding:22px 0;background:
    radial-gradient(80% 60% at 15% 0%, rgba(245,158,11,.18), transparent 60%),
    radial-gradient(80% 60% at 85% 0%, rgba(34,197,94,.14), transparent 60%)}
  .hero h2{margin:0 0 8px;font-size:28px}
  .usp{display:flex;gap:10px;flex-wrap:wrap}
  .tag{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid var(--line);font-weight:700}

  /* Layout */
  .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:14px}
  @media (max-width:980px){ .grid{grid-template-columns:1fr} }
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);padding:14px}
  h3{margin:0 0 10px}
  label{display:block;margin:10px 0 6px;color:var(--muted);font-weight:700}
  input,select,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid var(--line);background:#0f1626;color:var(--text);outline:none}
  :root[data-theme="light"] input,:root[data-theme="light"] select,:root[data-theme="light"] textarea{background:#f2f4f8;color:#111}
  input:focus,select:focus,textarea:focus{border-color:var(--accent)}
  .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (max-width:640px){ .row2{grid-template-columns:1fr} }
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{padding:8px 12px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.06);cursor:pointer}
  .chip.active{background:var(--brand);color:#111;font-weight:800;border-color:transparent}

  /* Offer panel */
  .offerHead{display:flex;align-items:center;justify-content:space-between;gap:10px}
  .range{font-size:26px;font-weight:900}

  /* Sticky */
  .sticky{position:sticky;bottom:0;z-index:20;background:rgba(11,15,23,.85);backdrop-filter:blur(8px);border-top:1px solid var(--line);padding:10px;border-radius:12px;margin-top:12px}
  .ctaRow{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-end}

  /* Toast */
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:#111827;color:#e5e7eb;border:1px solid var(--line);padding:10px 14px;border-radius:10px;box-shadow:var(--shadow);opacity:0;pointer-events:none;transition:opacity .25s}
  .toast.show{opacity:1}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="row">
      <div class="brand">
        <img src="https://wbjwvxckbfkutqqbgupq.supabase.co/storage/v1/object/public/vehicals/logo.png" alt="Second Wheel logo"/>
        <h1>SECOND WHEEL</h1>
      </div>
      <div class="row" style="gap:8px">
        <div class="seg" id="langSeg">
          <button data-lang="en" class="active">EN</button>
          <button data-lang="hi">HI</button>
          <button data-lang="mr">MR</button>
        </div>
        <button class="btn" id="darkToggle" aria-label="Toggle dark">üåô</button>
      </div>
    </div>
  </div>
</header>

<section class="hero">
  <div class="wrap">
    <h2>Sell Your Vehicle ‚Äî Get Best Offer (Instant)</h2>
    <div class="usp">
      <span class="tag">üßë‚Äçüîß Doorstep Inspection</span>
      <span class="tag">‚ö° Same-day Payment</span>
      <span class="tag">‚úÖ Paperwork Support</span>
      <span class="tag">üìç Satara Priority</span>
    </div>
  </div>
</section>

<main class="wrap">
  <div class="grid">
    <!-- LEFT: FORM (All fields compulsory) -->
    <section class="card">
      <h3>Step 1 ‚Äî Fill all details (Compulsory)</h3>

      <div class="row2">
        <div><label>Name *</label><input id="name" required autocomplete="name"></div>
        <div><label>Mobile (10-digit) *</label><input id="phone" required inputmode="numeric" maxlength="10" placeholder="98XXXXXXXX"></div>
      </div>

      <div class="row2">
        <div><label>City *</label><input id="city" required placeholder="Satara"></div>
        <div>
          <label>Type *</label>
          <select id="type" required>
            <option value="">Select‚Ä¶</option>
            <option value="car">Car</option>
            <option value="bike">Bike</option>
            <option value="scooter">Scooter</option>
          </select>
        </div>
      </div>

      <div class="row2">
        <div><label>Brand *</label><input id="brand" required placeholder="Maruti, Hyundai‚Ä¶"></div>
        <div><label>Model *</label><input id="model" required placeholder="Swift, i10‚Ä¶"></div>
      </div>

      <div class="row2">
        <div><label>Year *</label><input id="year" required type="number" inputmode="numeric" placeholder="2017"></div>
        <div><label>KM Driven *</label><input id="km" required type="number" inputmode="numeric" placeholder="72000"></div>
      </div>

      <label>Fuel *</label>
      <div class="chips" id="fuelChips">
        <span class="chip" data-val="petrol">Petrol</span>
        <span class="chip" data-val="diesel">Diesel</span>
        <span class="chip" data-val="cng">CNG</span>
        <span class="chip" data-val="electric">Electric</span>
      </div>

      <div class="row2" style="margin-top:8px">
        <div><label>Registration No. *</label><input id="reg" required placeholder="MH 11 AB 1234"></div>
        <div><label>Owner No. *</label><input id="owner" required type="number" min="1" max="6" placeholder="1"></div>
      </div>

      <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn primary" id="proceed">Get Best Offer</button>
        <span class="muted" id="saveHint">Price ‡§¶‡§ø‡§∏‡§£‡•ç‡§Ø‡§æ‡§Ü‡§ß‡•Ä ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§°‡•á‡§ü‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§‡§™‡§£‡•á save ‡§π‡•ã‡§à‡§≤.</span>
      </div>
      <div id="saveMsg" class="muted" style="margin-top:8px"></div>
    </section>

    <!-- RIGHT: OFFER (hidden until saved) -->
    <aside class="card" id="offerPanel" aria-live="polite">
      <div class="offerHead">
        <h3>Estimated Price (Not Final)</h3>
        <span class="tag">üìà Live</span>
      </div>
      <div class="range" id="offerRange">‚Äî</div>
      <div class="muted" id="offerNote">
        This is an indicative estimate. <b>Final price will be fixed after Doorstep Inspection.</b>
      </div>

      <div class="sticky" style="margin-top:16px">
        <div class="ctaRow">
          <a id="waBtn" class="btn success" target="_blank" rel="noopener">üí¨ WhatsApp</a>
          <button id="bookBtn" class="btn primary">Doorstep Inspection</button>
        </div>
      </div>
    </aside>
  </div>
</main>

<div id="toast" class="toast">Saved!</div>

<script>
/* ---------- Language + Theme ---------- */
const KEY_LANG='secondwheel.lang', KEY_THEME='secondwheel.theme';
const langSeg=document.getElementById('langSeg'); const darkBtn=document.getElementById('darkToggle');
function toast(t){ const el=document.getElementById('toast'); el.textContent=t; el.classList.add('show'); clearTimeout(window.__t); window.__t=setTimeout(()=>el.classList.remove('show'),1400); }
function applyLang(l){ localStorage.setItem(KEY_LANG,l); langSeg.querySelectorAll('button').forEach(b=>b.classList.toggle('active', b.dataset.lang===l)); }
function setTheme(t){ document.documentElement.setAttribute('data-theme',t); localStorage.setItem(KEY_THEME,t); darkBtn.textContent=(t==='dark')?'üåô':'‚òÄÔ∏è'; }
document.addEventListener('DOMContentLoaded',()=>{ applyLang(localStorage.getItem(KEY_LANG)||'en'); setTheme(localStorage.getItem(KEY_THEME)||'dark');
  langSeg.addEventListener('click',e=>{ const b=e.target.closest('button[data-lang]'); if(b) applyLang(b.dataset.lang); });
  darkBtn.addEventListener('click',()=>{ const next=(localStorage.getItem(KEY_THEME)||'dark')==='dark'?'light':'dark'; setTheme(next); });
});

/* ---------- Config ---------- */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxWAagtCw4FFyXOt8CqNE2yDSoEEacgBYKsTd8jYsTgmZxg60ndqH5BehSVUTR5zMQ_nA/exec";

/* ---------- Helpers ---------- */
const $ = id => document.getElementById(id);
function validPhone(v){ return /^\d{10}$/.test((v||'').trim()); }
function makeVID(){ const r=Math.random().toString(36).slice(2,6), ts=Date.now().toString(36).slice(-4); return `${ts}-${r}`; }
function money(n){ try{return '‚Çπ'+Number(n).toLocaleString('en-IN')}catch{return '‚Çπ'+n} }

/* ---------- Valuation ---------- */
function calcBase(type, brandStr, yearNum, fuel, kmNum){
  const now=new Date().getFullYear(); const age=Math.max(0, now-(Number(yearNum)||now));
  let base=(type==='car')?480000:(type==='bike'?40000:32000);
  const B=(brandStr||'').toUpperCase();
  if(type==='car' && ['MARUTI','HYUNDAI','HONDA','TOYOTA'].some(b=>B.includes(b))) base*=1.10;
  if(type==='bike' && ['HERO','BAJAJ','ROYAL ENFIELD'].some(b=>B.includes(b))) base*=1.10;
  if(type==='scooter' && ['HONDA','HERO','TVS'].some(b=>B.includes(b))) base*=1.08;
  if(type==='car'){ if(fuel==='diesel') base*=1.08; if(fuel==='cng') base*=1.05; if(fuel==='electric') base*=1.12; }
  base*=Math.max(0.35,(1-age*0.055));
  const kmx=Number(kmNum)||0; const over=Math.max(0, kmx-(type==='car'?45000:18000));
  const blocks=Math.floor(over/(type==='car'?9000:4500)); base*=(1-blocks*0.018);
  return Math.max(18000, Math.round(base));
}
function estimateRange(t,b,y,f,k){ const base=calcBase(t,b,y,f,k); return { min:Math.round(base*0.97), max:Math.round(base*1.06), base }; }

/* ---------- Form state ---------- */
let FUEL = null;
$('fuelChips').addEventListener('click', e=>{
  const c=e.target.closest('.chip'); if(!c) return;
  [...$('fuelChips').children].forEach(x=>x.classList.remove('active'));
  c.classList.add('active'); FUEL=c.dataset.val;
});

/* ---------- Required fields ---------- */
const requiredIds = ['name','phone','city','type','brand','model','year','km','reg','owner'];
function validateAll(){
  for(const id of requiredIds){
    const el=$(id); if(!el.value || !el.value.trim()){ el.focus(); return 'Please fill '+id.toUpperCase(); }
  }
  if(!FUEL) return 'Please select FUEL';
  if(!validPhone($('phone').value)) return 'Enter valid 10-digit Mobile';
  return '';
}

/* ---------- Save then show price ---------- */
$('offerPanel').classList.add('hidden'); // hide initially
$('proceed').addEventListener('click', async ()=>{
  const err = validateAll();
  if(err){ alert(err); return; }

  const vid = makeVID();
  const payload = {
    vid,
    name:$('name').value.trim(),
    phone:$('phone').value.trim(),
    city:$('city').value.trim(),
    type:$('type').value,
    brand:$('brand').value.trim(),
    model:$('model').value.trim(),
    year:$('year').value.trim(),
    fuel:FUEL,
    km:$('km').value.trim(),
    reg:$('reg').value.trim(),
    owner:$('owner').value.trim(),
    rcStatus:'ok', insuranceStatus:'ok', greenTax:'ok',
    notes:'Lead via Sell Page (pre-offer save)', source:'sell-page'
  };

  // Save first
  $('saveMsg').textContent='Saving‚Ä¶';
  $('proceed').disabled = true;
  try{
    const res = await fetch(SCRIPT_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload) });
    const out = await res.json().catch(()=>({}));
    if(!out || !out.ok) throw new Error(out && out.error ? out.error : 'Save failed');

    $('saveMsg').innerHTML = '<span class="ok">Saved ‚úì</span> (ID: '+(out.id||vid)+')';
    toast('Saved');

    // Now compute & show price
    const rng = estimateRange(payload.type, payload.brand, payload.year, payload.fuel, payload.km);
    $('offerRange').textContent = money(rng.min)+' ‚Äì '+money(rng.max);
    $('offerPanel').classList.remove('hidden');

    const msg = `Sell Enquiry (Estimate not final)
${payload.brand} ${payload.model} ${payload.year} ‚Ä¢ ${payload.fuel.toUpperCase()}
KM: ${payload.km} ‚Ä¢ City: ${payload.city}
Estimate: ${$('offerRange').textContent}
Mobile: ${payload.phone}
ID: ${out.id||vid}
Note: Final price after Doorstep Inspection.`;
    $('waBtn').href = 'https://wa.me/919822292955?text='+encodeURIComponent(msg);

  }catch(e){
    $('saveMsg').innerHTML = '<span class="err">Save error:</span> '+e.message;
    $('offerPanel').classList.add('hidden'); // don‚Äôt reveal price
  }
  $('proceed').disabled = false;
});

/* ---------- Doorstep Inspection CTA ---------- */
$('bookBtn').addEventListener('click', ()=>{
  alert('Thanks! Our team will call you to schedule a doorstep inspection.\n(You can also ping on WhatsApp.)');
});
</script>
</body>
</html>
