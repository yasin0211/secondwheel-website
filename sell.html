<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Second Wheel ‚Äî Sell</title>
<meta name="theme-color" content="#0b0f17"/>
<style>
  :root{
    --bg:#0b0f17; --card:#121826; --text:#e5e7eb; --muted:#9aa3b2;
    --line:rgba(255,255,255,.1); --brand:#f59e0b; --ok:#22c55e; --bad:#ef4444;
    --shadow:0 10px 28px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);
    font:14px/1.6 system-ui,-apple-system,Segoe UI,Roboto}
  img{max-width:100%;display:block}
  .wrap{max-width:980px;margin:0 auto;padding:14px 16px}
  /* Header (no navbar) */
  header{position:sticky;top:0;z-index:30;background:rgba(11,15,23,.78);
    backdrop-filter:blur(10px);border-bottom:1px solid var(--line)}
  .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .brand{display:flex;align-items:center;gap:12px}
  .brand img{width:56px;height:56px;border-radius:14px;box-shadow:var(--shadow)}
  .brand h1{margin:0;font-size:16px;letter-spacing:.4px}
  .seg{display:inline-flex;gap:8px;padding:6px;border:1px solid var(--line);
    border-radius:999px;background:rgba(255,255,255,.04)}
  .seg button{border:0;background:transparent;padding:10px 14px;border-radius:999px;
    color:var(--text);cursor:pointer}
  .seg button.active{background:var(--brand);color:#111;font-weight:800}
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;
    padding:12px 16px;border-radius:12px;border:1px solid var(--line);
    background:rgba(255,255,255,.06);cursor:pointer}
  .btn.primary{background:linear-gradient(180deg,#f59e0b,#b45309);color:#111;border:none}
  .btn:active{transform:translateY(1px)}
  /* Card + Form */
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;
    box-shadow:var(--shadow);padding:14px;margin-top:12px}
  h2{margin:0 0 8px;font-size:18px}
  label{display:block;margin:10px 0 6px;color:var(--muted);font-weight:700}
  input,select,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid var(--line);
    background:#0f1626;color:var(--text);outline:none}
  input:focus,select:focus,textarea:focus{border-color:#3b82f6}
  .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (max-width:640px){.row2{grid-template-columns:1fr}}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{padding:8px 12px;border-radius:999px;border:1px solid var(--line);
    background:rgba(255,255,255,.06);cursor:pointer}
  .chip.active{background:var(--brand);color:#111;font-weight:800;border-color:transparent}
  .muted{color:var(--muted)}
  .note{margin-top:8px;padding:10px;border-radius:10px;border:1px dashed var(--line);color:#d1d5db}
  .ok{color:var(--ok)} .bad{color:var(--bad)}
  .hidden{display:none !important}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:#111827;
    color:#e5e7eb;border:1px solid var(--line);padding:10px 14px;border-radius:10px;
    box-shadow:var(--shadow);opacity:0;pointer-events:none;transition:opacity .25s}
  .toast.show{opacity:1}
  .price{font-size:24px;font-weight:900}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="row">
      <div class="brand">
        <img src="https://wbjwvxckbfkutqqbgupq.supabase.co/storage/v1/object/public/vehicals/logo.png" alt="Second Wheel"/>
        <h1>SECOND WHEEL</h1>
      </div>
      <div class="seg" id="langSeg">
        <button data-lang="en" class="active">EN</button>
        <button data-lang="hi">HI</button>
        <button data-lang="mr">MR</button>
      </div>
      <button class="btn" id="darkToggle" aria-label="Toggle dark">üåô</button>
    </div>
  </div>
</header>

<main class="wrap">
  <!-- Step 1: Details (all required) -->
  <section class="card" id="step1">
    <h2>Tell us about your vehicle</h2>
    <div class="row2">
      <div>
        <label>Type *</label>
        <select id="type" required>
          <option value="">Select</option>
          <option value="car">Car</option>
          <option value="bike">Bike</option>
          <option value="scooter">Scooter</option>
        </select>
      </div>
      <div>
        <label>City *</label>
        <input id="city" placeholder="Satara" required/>
      </div>
    </div>
    <div class="row2">
      <div>
        <label>Brand *</label>
        <input id="brand" placeholder="Maruti / Hyundai‚Ä¶" required/>
      </div>
      <div>
        <label>Model *</label>
        <input id="model" placeholder="Swift / i10‚Ä¶" required/>
      </div>
    </div>
    <div class="row2">
      <div>
        <label>Year *</label>
        <input id="year" type="number" inputmode="numeric" placeholder="2016" required/>
      </div>
      <div>
        <label>KM Driven *</label>
        <input id="km" type="number" inputmode="numeric" placeholder="72000" required/>
      </div>
    </div>

    <label>Fuel *</label>
    <div class="chips" id="fuelChips" aria-label="Fuel">
      <span class="chip" data-val="petrol">Petrol</span>
      <span class="chip" data-val="diesel">Diesel</span>
      <span class="chip" data-val="cng">CNG</span>
      <span class="chip" data-val="electric">Electric</span>
    </div>

    <div class="row2" style="margin-top:8px">
      <div>
        <label>Registration No. *</label>
        <input id="reg" placeholder="MH 11 AB 1234" required/>
      </div>
      <div>
        <label>Owner No. *</label>
        <input id="owner" type="number" inputmode="numeric" placeholder="1" required/>
      </div>
    </div>

    <div class="row2" style="margin-top:8px">
      <div>
        <label>Your Name *</label>
        <input id="name" placeholder="Full name" required/>
      </div>
      <div>
        <label>Mobile *</label>
        <input id="phone" placeholder="10-digit mobile" maxlength="10" inputmode="numeric" required/>
      </div>
    </div>

    <div class="note">
      Price ‡§¶‡§æ‡§ñ‡§µ‡§£‡•ç‡§Ø‡§æ‡§Ü‡§ß‡•Ä ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§°‡•á‡§ü‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§‡§™‡§£‡•á save ‡§π‡•ã‡§à‡§≤.
    </div>

    <div style="margin-top:12px;display:flex;gap:10px;justify-content:flex-end">
      <button class="btn primary" id="getOffer">Get Best Offer</button>
    </div>
    <div id="saveErr" class="bad hidden" style="margin-top:10px"></div>
  </section>

  <!-- Step 2: Offer (shown only after save) -->
  <section class="card hidden" id="step2">
    <h2>Estimated Offer</h2>
    <div class="price" id="priceText">‚Çπ ‚Äî</div>
    <div class="note">
      ‡§π‡•Ä ‡§ï‡§ø‡§Ç‡§Æ‡§§ <b>Estimate</b> ‡§Ü‡§π‡•á. <b>Doorstep inspection</b> ‡§®‡§Ç‡§§‡§∞ ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§ï‡§ø‡§Ç‡§Æ‡§§ ‡§´‡§ø‡§ï‡•ç‡§∏ ‡§π‡•ã‡§à‡§≤.
    </div>

    <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
      <a class="btn" id="whatsApp" target="_blank" rel="noopener">Chat on WhatsApp</a>
      <button class="btn" id="bookInsp">Book Doorstep Inspection</button>
    </div>
  </section>
</main>

<div id="toast" class="toast">Saved!</div>

<script>
/* ------------ Language + Theme ------------- */
const I18N = {
  en:{}, hi:{}, mr:{}
};
const KEY_LANG='secondwheel.lang', KEY_THEME='secondwheel.theme';
const langSeg=document.getElementById('langSeg'), darkBtn=document.getElementById('darkToggle');
function applyLang(l){ localStorage.setItem(KEY_LANG,l);
  langSeg.querySelectorAll('button').forEach(b=>b.classList.toggle('active', b.dataset.lang===l));
}
function setTheme(x){ document.documentElement.setAttribute('data-theme',x);
  localStorage.setItem(KEY_THEME,x); darkBtn.textContent=(x==='dark')?'üåô':'‚òÄÔ∏è';}
function toast(m){ const el=document.getElementById('toast'); el.textContent=m; el.classList.add('show');
  clearTimeout(window.__t); window.__t=setTimeout(()=>el.classList.remove('show'),1500); }
document.addEventListener('DOMContentLoaded',()=>{
  applyLang(localStorage.getItem(KEY_LANG)||'en');
  setTheme(localStorage.getItem(KEY_THEME)||'dark');
  langSeg.addEventListener('click',e=>{ const b=e.target.closest('button[data-lang]');
    if(b){ applyLang(b.dataset.lang); toast('Language: '+b.dataset.lang.toUpperCase()); }});
  darkBtn.addEventListener('click',()=>{ const next=(localStorage.getItem(KEY_THEME)||'dark')==='dark'?'light':'dark'; setTheme(next);});
});

/* ------------ CONFIG: Google Apps Script endpoint ------------- */
/* ‡§§‡•Å‡§ù‡§æ /exec URL ‡§á‡§•‡•á ‡§¶‡§ø‡§≤‡§æ‡§Ø */
const GS_ENDPOINT = "https://script.google.com/macros/s/AKfycbxWAagtCw4FFyXOt8CqNE2yDSoEEacgBYKsTd8jYsTgmZxg60ndqH5BehSVUTR5zMQ_nA/exec";

/* ------------ Form refs + state ------------- */
const step1=document.getElementById('step1'), step2=document.getElementById('step2');
const typeEl=type, cityEl=city, brandEl=brand, modelEl=model, yearEl=year, kmEl=km, regEl=reg, ownerEl=owner;
const nameEl=name, phoneEl=phone, fuelChips=document.getElementById('fuelChips');
const getOfferBtn=document.getElementById('getOffer'), saveErr=document.getElementById('saveErr');
const priceText=document.getElementById('priceText'), waBtn=document.getElementById('whatsApp');

let FUEL=null, VID=makeVID();
function makeVID(){ const r=Math.random().toString(36).slice(2,6), ts=Date.now().toString(36).slice(-4); return `${ts}-${r}`; }

fuelChips.addEventListener('click',e=>{
  const c=e.target.closest('.chip'); if(!c) return;
  [...fuelChips.children].forEach(x=>x.classList.remove('active'));
  c.classList.add('active'); FUEL=c.dataset.val;
});

/* ------------ Validation ------------- */
function requiredFilled(){
  const all = [typeEl,cityEl,brandEl,modelEl,yearEl,kmEl,regEl,ownerEl,nameEl,phoneEl];
  let ok = all.every(el=> (el.value||'').trim().length>0);
  if(!FUEL) ok=false;
  return ok;
}

/* ------------ Valuation ------------- */
function calcBase(tp, brandStr, yearNum, fuel, kmNum){
  const now=new Date().getFullYear(); const age=Math.max(0, now-(Number(yearNum)||now));
  let base=(tp==='car')?450000:(tp==='bike'?35000:30000);
  const B=(brandStr||'').toUpperCase();
  if(tp==='car' && ['MARUTI','HYUNDAI','HONDA','TOYOTA'].some(b=>B.includes(b))) base*=1.08;
  if(tp==='bike' && ['HERO','BAJAJ','ROYAL ENFIELD'].some(b=>B.includes(b))) base*=1.10;
  if(tp==='scooter' && ['HERO','TVS','HONDA'].some(b=>B.includes(b))) base*=1.08;
  if(tp==='car'){ if(fuel==='diesel') base*=1.08; if(fuel==='cng') base*=1.05; if(fuel==='electric') base*=1.12; }
  base*=Math.max(0.35,(1-age*0.06));
  const kmx=Number(kmNum)||0; const over=Math.max(0, kmx-(tp==='car'?50000:20000));
  const blocks=Math.floor(over/(tp==='car'?10000:5000)); base*=(1-blocks*0.02);
  return Math.max(15000, Math.round(base));
}
function estimateRange(tp, brandStr, yearNum, fuel, kmNum){
  const base=calcBase(tp,brandStr,yearNum,fuel,kmNum);
  return { min: Math.round(base*0.96), max: Math.round(base*1.05) };
}

/* ------------ Save + then show offer ------------- */
getOfferBtn.addEventListener('click', async ()=>{
  saveErr.classList.add('hidden'); saveErr.textContent='';
  if(!requiredFilled()){ toast('Please fill all required fields'); return; }
  const payload={
    vid:VID, source:'sell-web',
    name:nameEl.value.trim(), phone:phoneEl.value.trim(), city:cityEl.value.trim(),
    type:typeEl.value, brand:brandEl.value.trim(), model:modelEl.value.trim(),
    year:yearEl.value.trim(), fuel:FUEL, km:kmEl.value.trim(),
    reg:regEl.value.trim(), owner:ownerEl.value.trim()
  };

  // Save to Google Sheets
  try{
    const res = await fetch(GS_ENDPOINT, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(payload)
    });
    if(!res.ok){ throw new Error('Endpoint error: '+res.status); }
    const out = await res.json();
    if(!out.ok){ throw new Error(out.error||'Save failed'); }
  }catch(err){
    saveErr.textContent = 'Save error: '+err.message;
    saveErr.classList.remove('hidden');
    return;
  }

  // Compute & show price AFTER save
  const rng = estimateRange(typeEl.value, brandEl.value, yearEl.value, FUEL, kmEl.value);
  priceText.textContent = '‚Çπ '+rng.min.toLocaleString('en-IN')+' ‚Äì ‚Çπ '+rng.max.toLocaleString('en-IN');

  const msg = `Sell Enquiry
${brandEl.value} ${modelEl.value} ${yearEl.value} ‚Ä¢ ${FUEL?.toUpperCase()}
KM: ${kmEl.value} ‚Ä¢ City: ${cityEl.value}
Est Range: ‚Çπ${rng.min.toLocaleString('en-IN')}‚Äì‚Çπ${rng.max.toLocaleString('en-IN')}
Owner:${ownerEl.value} ‚Ä¢ Reg:${regEl.value}
ID: ${VID}`;
  waBtn.href='https://wa.me/919822292955?text='+encodeURIComponent(msg);

  step2.classList.remove('hidden');
  step2.scrollIntoView({behavior:'smooth',block:'start'});
  toast('Saved ‚úì');
});
</script>
</body>
</html>
