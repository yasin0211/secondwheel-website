<!DOCTYPE html>
<html>
<head>
  <title>Upload Vehicle</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, select, textarea { margin-bottom: 10px; width: 100%; padding: 8px; }
    img { max-width: 200px; margin-top: 10px; }
    button { background: green; color: white; padding: 10px; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Vehicle Upload Form (Supabase)</h2>
  
  <form id="vehicleForm">
    <input type="text" id="category" placeholder="Category" required>
    <input type="text" id="brand" placeholder="Brand" required>
    <input type="text" id="model" placeholder="Model" required>
    <input type="number" id="year" placeholder="Year" required>
    <input type="number" id="price" placeholder="Price (₹)" required>
    <input type="text" id="city" placeholder="City" required>
    <input type="text" id="fuel" placeholder="Fuel Type" required>
    <input type="text" id="condition" placeholder="Condition" required>
    <input type="text" id="ownership" placeholder="Ownership" required>
    <select id="rc">
      <option value="">RC Available?</option>
      <option>Yes</option>
      <option>No</option>
    </select>
    <input type="text" id="rto" placeholder="RTO Code (e.g. MH12)" required>

    <input type="file" id="imageInput" accept="image/*" required>
    <img id="preview" src="#" alt="Preview" style="display:none;" />
    
    <textarea id="description" placeholder="Description" required></textarea>
    <button type="submit">Submit</button>
  </form>

  <script>
    // ✅ Supabase Init
    const SUPABASE_URL = "https://wbjwvxckbfkutqqbgupq.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ✅ Preview image
    const imageInput = document.getElementById('imageInput');
    const preview = document.getElementById('preview');
    imageInput.addEventListener('change', function () {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          preview.src = e.target.result;
          preview.style.display = "block";
        };
        reader.readAsDataURL(file);
      }
    });

    // ✅ Submit Form
    document.getElementById('vehicleForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const file = imageInput.files[0];
      const fileName = `${Date.now()}_${file.name}`;
      const { data: imgData, error: imgErr } = await supabase.storage
        .from('vehicle-images')
        .upload(fileName, file);

      if (imgErr) return alert('Image upload failed.');

      const imageUrl = `${SUPABASE_URL}/storage/v1/object/public/vehicle-images/${fileName}`;

      const formData = {
        category: document.getElementById('category').value,
        brand: document.getElementById('brand').value,
        model: document.getElementById('model').value,
        year: parseInt(document.getElementById('year').value),
        price: parseInt(document.getElementById('price').value),
        city: document.getElementById('city').value,
        fuel: document.getElementById('fuel').value,
        condition: document.getElementById('condition').value,
        ownership: document.getElementById('ownership').value,
        rc: document.getElementById('rc').value,
        rto: document.getElementById('rto').value,
        image: imageUrl,
        description: document.getElementById('description').value
      };

      const { data, error } = await supabase
        .from('vehicles')
        .insert([formData]);

      if (error) {
        alert('Upload failed');
        console.error(error);
      } else {
        alert('Vehicle uploaded successfully!');
        document.getElementById('vehicleForm').reset();
        preview.style.display = "none";
      }
    });
  </script>
</body>
</html>
