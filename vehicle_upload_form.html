<!DOCTYPE html>
<html>
<head>
  <title>Upload Vehicle</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, select, textarea { margin-bottom: 10px; width: 100%; padding: 8px; }
    img { max-width: 200px; margin-top: 10px; }
    button { background: green; color: white; padding: 10px; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Vehicle Upload Form (Supabase)</h2>

  <form id="uploadForm">
    <select name="category" required>
      <option value="">Select Category</option>
      <option value="Car">Car</option>
      <option value="Bike">Bike</option>
      <option value="Scooter">Scooter</option>
    </select>

    <input type="text" name="brand" placeholder="Brand" required />
    <input type="text" name="model" placeholder="Model" required />
    <input type="number" name="year" placeholder="Year" required />
    <input type="number" name="price" placeholder="Price (₹)" required />
    <input type="text" name="city" placeholder="City" required />

    <select name="fuel" required>
      <option value="">Fuel</option>
      <option>Petrol</option>
      <option>Diesel</option>
      <option>CNG</option>
      <option>Electric</option>
    </select>

    <input type="text" name="condition" placeholder="Condition (e.g., Excellent)" required />
    <input type="text" name="ownership" placeholder="Ownership (e.g., 1st, 2nd)" required />

    <select name="rc" required>
      <option value="">RC Available?</option>
      <option value="Yes">Yes</option>
      <option value="No">No</option>
    </select>

    <input type="file" id="imageInput" accept="image/*" required />
    <img id="preview" style="display:none;" />

    <textarea name="description" placeholder="Description"></textarea>

    <button type="button" onclick="uploadVehicle()">Submit</button>
  </form>

  <script>
    const supabase = supabase.createClient(
      'https://wbjwvxckbfkutqqbgupq.supabase.co', // Replace with your Supabase URL
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzIiw...' // Replace with your Anon Key
    );

    const imageInput = document.getElementById('imageInput');
    const preview = document.getElementById('preview');
    let uploadedImageURL = "";

    imageInput.addEventListener('change', async function () {
      const file = imageInput.files[0];
      if (!file) return;

      preview.src = URL.createObjectURL(file);
      preview.style.display = "block";

      const filePath = `vehicle-${Date.now()}.jpg`;
      const { data, error } = await supabase.storage.from('vehicle-images').upload(filePath, file);

      if (error) {
        alert("❌ Image upload failed: " + error.message);
        return;
      }

      const { data: urlData } = supabase.storage.from('vehicle-images').getPublicUrl(filePath);
      uploadedImageURL = urlData.publicUrl;
    });

    async function uploadVehicle() {
      const form = document.getElementById('uploadForm');
      if (!uploadedImageURL) return alert("Please wait for image to upload.");

      const vehicleData = {
        category: form.category.value,
        brand: form.brand.value,
        model: form.model.value,
        year: parseInt(form.year.value),
        price: parseInt(form.price.value),
        city: form.city.value,
        fuel: form.fuel.value,
        condition: form.condition.value,
        ownership: form.ownership.value,
        rc: form.rc.value,
        image_url: uploadedImageURL,
        description: form.description.value
      };

      const { error } = await supabase.from('vehicles').insert([vehicleData]);

      if (error) {
        alert("❌ Upload failed: " + error.message);
      } else {
        alert("✅ Vehicle uploaded successfully!");
        form.reset();
        preview.src = "";
        preview.style.display = "none";
      }
    }
  </script>
</body>
</html>
